import{aU as hr,r as c,s as e,aX as Ct}from"./index-DqN4Ab-6.js";import{e as zt,S as Ds,d as Xs,U as gr,G as br,B as q,T as xt,a as pt,b as ht,c as gt,L as Ft,Z as Ut,P as fr,C as Ze}from"./tooltip-CuA3uCck.js";import{a as X,B as w,X as Gt,c as $,I as L,C as Wt,i as jr,j as vr,k as Vt}from"./x-CBMUblKp.js";import{m as ce,n as oe,o as le,p as ie,q as B,T as Re,a as Ee,b as J,c as H,D as fs,e as js,f as vs,g as ws,h as Ts,L as _,t as Ns,r as Ks,d as wr}from"./dialog-CXJV4Jkg.js";import{P as be,a as he,A as qt,S as Nr}from"./scroll-area-DiaPH08x.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],Kt=X("book",yr);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Jt=X("circle-alert",kr);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Sr=X("circle-check-big",Cr);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ss=X("circle-check",_r);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ht=X("circle-play",Ir);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],bt=X("circle",Ar);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Xt=X("clock",Pr);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],Yt=X("git-branch",Dr);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Qt=X("pencil",Tr);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ge=X("refresh-cw",Rr);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],jt=X("settings",Er);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Br=X("tag",Mr);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],$r=X("target",Lr);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],zr=X("trending-up",Or);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fr=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Zt=X("user",Fr);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],vt=X("wifi-off",Ur);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],er=X("wifi",Gr),Js=[{id:"backlog",name:"Backlog",color:"#6b7280",description:"Story only exists in epic file"},{id:"ready-for-dev",name:"Ready for Dev",color:"#3b82f6",description:"Story file created in stories folder"},{id:"in-progress",name:"In Progress",color:"#f59e0b",description:"Developer actively working on implementation"},{id:"review",name:"Review",color:"#8b5cf6",description:"Ready for code review"},{id:"done",name:"Done",color:"#22c55e",description:"Story completed"}],Wr=[{id:"low",name:"Low",color:"#6b7280"},{id:"medium",name:"Medium",color:"#3b82f6"},{id:"high",name:"High",color:"#f59e0b"},{id:"critical",name:"Critical",color:"#ef4444"}],gs="http://localhost:3847",St="kanban-server-base-url",_t="kanban-use-remote-server",bs=r=>{const m=String(r||"").trim();return m?m.replace(/[\\/]+$/,""):""},es=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Vr=()=>{let r=localStorage.getItem("kanban-user-id");return r||(r=`user-${es().slice(0,8)}`,localStorage.setItem("kanban-user-id",r)),r},Hs=hr((r,m)=>({state:null,loading:!0,error:null,connected:!1,userId:Vr(),autoConnect:localStorage.getItem("kanban-auto-connect")!=="false",serverRunning:!1,useRemoteServer:localStorage.getItem(_t)==="true",serverBaseUrl:bs(localStorage.getItem(St)||gs),eventSource:null,reconnectAttempts:0,maxReconnectAttempts:5,activeBoardId:null,selectedCardId:null,cardBeingEdited:null,lockedCards:{},connect:async()=>{const{eventSource:s,userId:a,serverBaseUrl:n,useRemoteServer:d}=m();if(s&&s.close(),r({loading:!0,error:null}),!d&&m().autoConnect&&window.electronAPI)try{await window.electronAPI.startMcpServer(),r({serverRunning:!0}),await new Promise(x=>setTimeout(x,1e3))}catch(x){console.error("Failed to start MCP server:",x)}const u=`${bs(n)||gs}/sse`,b=new EventSource(`${u}?userId=${a}`);b.onopen=()=>{r({connected:!0,reconnectAttempts:0,serverRunning:!0})},b.addEventListener("connected",x=>{var h,f,C,N,y;try{const R=JSON.parse(x.data);r({state:R.state,activeBoardId:((h=R.state)==null?void 0:h.activeBoardId)||((N=(C=(f=R.state)==null?void 0:f.boards)==null?void 0:C[0])==null?void 0:N.id)||null,loading:!1,lockedCards:((y=R.state)==null?void 0:y.locks)||{}})}catch(R){console.error("Failed to parse connected event:",R)}}),b.addEventListener("state_update",x=>{var h;try{const f=JSON.parse(x.data);r({state:f.data,lockedCards:((h=f.data)==null?void 0:h.locks)||{}})}catch(f){console.error("Failed to parse state_update event:",f)}}),b.addEventListener("card_locked",x=>{try{const h=JSON.parse(x.data);r(f=>({lockedCards:{...f.lockedCards,[h.data.cardId]:{userId:h.data.userId,expiresAt:h.data.expiresAt}}}))}catch(h){console.error("Failed to parse card_locked event:",h)}}),b.addEventListener("card_unlocked",x=>{try{const h=JSON.parse(x.data);r(f=>{const{[h.data.cardId]:C,...N}=f.lockedCards;return{lockedCards:N}})}catch(h){console.error("Failed to parse card_unlocked event:",h)}}),b.addEventListener("card_moved",x=>{console.log("Card moved:",x.data)}),b.addEventListener("card_created",x=>{console.log("Card created:",x.data)}),b.addEventListener("card_updated",x=>{console.log("Card updated:",x.data)}),b.addEventListener("card_deleted",x=>{console.log("Card deleted:",x.data)}),b.onerror=()=>{const{reconnectAttempts:x,maxReconnectAttempts:h}=m();if(r({connected:!1}),x<h){const f=Math.min(1e3*Math.pow(2,x),3e4);setTimeout(()=>{r({reconnectAttempts:x+1}),m().connect()},f)}else r({error:"Failed to connect to Kanban server. Please ensure the MCP server is running.",loading:!1})},r({eventSource:b})},disconnect:()=>{const{eventSource:s}=m();s&&s.close(),r({eventSource:null,connected:!1})},loadLocalState:()=>{var s,a;try{const n=localStorage.getItem("kanban-state"),d=n?JSON.parse(n):null;if((s=d==null?void 0:d.boards)!=null&&s.length){r({state:d,activeBoardId:d.activeBoardId||((a=d.boards[0])==null?void 0:a.id)||null,loading:!1});return}const l=m().createDefaultState();localStorage.setItem("kanban-state",JSON.stringify(l)),r({state:l,activeBoardId:l.activeBoardId,loading:!1})}catch(n){r({error:n.message,loading:!1})}},createDefaultState:()=>{const s=es();return{version:2,stateVersion:1,activeBoardId:s,boards:[{id:s,name:"Sprint Board",type:"bmad",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),lists:Js.map(a=>({id:es(),statusId:a.id,name:a.name,color:a.color,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),cards:[]}))}],epics:[],locks:{}}},apiCall:async(s,a={})=>{const{userId:n,state:d,serverBaseUrl:l}=m(),b=`${bs(l)||gs}/api`;try{const x=await fetch(`${b}${s}`,{method:"POST",headers:{"Content-Type":"application/json","X-User-Id":n,"X-State-Version":String((d==null?void 0:d.stateVersion)||0)},body:JSON.stringify(a)});if(!x.ok){const h=await x.json();throw new Error(h.error||"API request failed")}return x.json()}catch(x){throw console.warn("API call failed, using local fallback:",x.message),x}},setActiveBoard:s=>{r({activeBoardId:s});const{state:a,apiCall:n,connected:d}=m();d&&a&&n("/state",{state:{...a,activeBoardId:s}}).catch(console.error)},createBoard:async(s,a="bmad")=>{const{apiCall:n,connected:d,state:l}=m();if(d)try{const h=await n("/board/create",{name:s,type:a});return r({activeBoardId:h.boardId}),h.boardId}catch(h){return r({error:h.message}),null}const u=es(),b={id:u,name:s,type:a,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),lists:a==="bmad"?Js.map(h=>({id:es(),statusId:h.id,name:h.name,color:h.color,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),cards:[]})):[{id:es(),name:"Backlog",cards:[]}]},x={...l,activeBoardId:u,boards:[...(l==null?void 0:l.boards)||[],b]};return localStorage.setItem("kanban-state",JSON.stringify(x)),r({state:x,activeBoardId:u}),u},deleteBoard:async s=>{var x;const{apiCall:a,connected:n,state:d}=m();if(n){try{await a("/board/delete",{boardId:s})}catch(h){r({error:h.message})}return}const l=d.boards.filter(h=>h.id!==s),u=d.activeBoardId===s?((x=l[0])==null?void 0:x.id)||null:d.activeBoardId,b={...d,activeBoardId:u,boards:l};localStorage.setItem("kanban-state",JSON.stringify(b)),r({state:b,activeBoardId:u})},deleteList:async(s,a)=>{var h;const{apiCall:n,connected:d,state:l}=m();if(d)try{return await n("/list/delete",{boardId:s,listId:a}),!0}catch(f){return r({error:f.message}),!1}if(!((h=l==null?void 0:l.boards)!=null&&h.length))return!1;const u=l.boards.find(f=>f.id===s);if(!u)return!1;const b={...u,lists:u.lists.filter(f=>f.id!==a),updatedAt:new Date().toISOString()},x={...l,boards:l.boards.map(f=>f.id===s?b:f)};return localStorage.setItem("kanban-state",JSON.stringify(x)),r({state:x}),!0},renameList:async(s,a,n)=>{var N;const{apiCall:d,connected:l,state:u}=m(),b=String(n||"").trim();if(!b)return!1;if(l)try{return await d("/list/rename",{boardId:s,listId:a,name:b}),!0}catch(y){return r({error:y.message}),!1}if(!((N=u==null?void 0:u.boards)!=null&&N.length))return!1;const x=u.boards.find(y=>y.id===s);if(!x||!x.lists.find(y=>y.id===a))return!1;const f={...x,lists:x.lists.map(y=>y.id===a?{...y,name:b,updatedAt:new Date().toISOString()}:y),updatedAt:new Date().toISOString()},C={...u,boards:u.boards.map(y=>y.id===s?f:y)};return localStorage.setItem("kanban-state",JSON.stringify(C)),r({state:C}),!0},addList:async(s,a,n={})=>{var y,R;const{apiCall:d,connected:l,state:u}=m(),b=String(a||"").trim();if(!b)return!1;const x=n.color||((y=Js[0])==null?void 0:y.color)||"#6b7280",h=n.statusId||null;if(l)try{return await d("/list/add",{boardId:s,name:b,statusId:h,color:x}),!0}catch(U){return r({error:U.message}),!1}if(!((R=u==null?void 0:u.boards)!=null&&R.length))return!1;const f=u.boards.find(U=>U.id===s);if(!f)return!1;const C={...f,lists:[...f.lists,{id:es(),statusId:h,name:b,color:x,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),cards:[]}],updatedAt:new Date().toISOString()},N={...u,boards:u.boards.map(U=>U.id===s?C:U)};return localStorage.setItem("kanban-state",JSON.stringify(N)),r({state:N}),!0},moveList:async(s,a,n)=>{var te,G;const{apiCall:d,connected:l,state:u}=m();if(!((te=u==null?void 0:u.boards)!=null&&te.length))return!1;const b=u.boards.find(z=>z.id===s);if(!((G=b==null?void 0:b.lists)!=null&&G.length))return!1;const x=b.lists.findIndex(z=>z.id===a);if(x<0)return!1;const h=Number(n),f=Number.isFinite(h)?Math.max(0,Math.min(h,b.lists.length)):0,C=[...b.lists],[N]=C.splice(x,1);if(!N)return!1;let y=f;x<y&&(y-=1),y=Math.max(0,Math.min(y,C.length)),C.splice(y,0,N);const R={...b,lists:C,updatedAt:new Date().toISOString()},U={...u,boards:u.boards.map(z=>z.id===s?R:z)};if(localStorage.setItem("kanban-state",JSON.stringify(U)),r({state:U}),l)try{return await d("/state",{state:U}),!0}catch(z){return r({error:z.message}),!1}return!0},addCard:async(s,a,n)=>{const{apiCall:d,connected:l}=m();if(l)try{return(await d("/card/add",{boardId:s,listId:a,...n})).cardId}catch(u){return r({error:u.message}),null}return null},updateCard:async(s,a,n,d)=>{const{apiCall:l,connected:u,userId:b,lockedCards:x}=m(),h=x[n];if(h&&h.userId!==b){const f=Date.now(),C=new Date(h.expiresAt).getTime();if(f<C)return r({error:`Card is being edited by ${h.userId}. Please try again.`}),!1}if(u)try{return await l("/card/update",{boardId:s,listId:a,cardId:n,patch:d}),!0}catch(f){return r({error:f.message}),!1}return!1},deleteCard:async(s,a,n)=>{const{apiCall:d,connected:l}=m();if(l)try{return await d("/card/delete",{boardId:s,listId:a,cardId:n}),!0}catch(u){return r({error:u.message}),!1}return!1},moveCard:async(s,a,n,d,l)=>{const{apiCall:u,connected:b,userId:x,lockedCards:h}=m(),f=h[a];if(f&&f.userId!==x){const C=Date.now(),N=new Date(f.expiresAt).getTime();if(C<N)return r({error:`Card "${a}" is locked by another user. Please wait.`}),!1}if(b)try{return await u("/card/move",{boardId:s,cardId:a,fromListId:n,toListId:d,toIndex:l}),!0}catch(C){return r({error:C.message}),!1}return!1},acquireLock:async s=>{const{apiCall:a,connected:n,userId:d}=m();if(n)try{const l=await a("/lock/acquire",{cardId:s,userId:d});return l.success||r({error:`Card is locked by ${l.lockedBy}`}),l.success}catch(l){return r({error:l.message}),!1}return!0},releaseLock:async s=>{const{apiCall:a,connected:n,userId:d}=m();if(n)try{return await a("/lock/release",{cardId:s,userId:d}),!0}catch(l){return console.error("Failed to release lock:",l),!1}return!0},isCardLocked:s=>{const{lockedCards:a,userId:n}=m(),d=a[s];if(!d||d.userId===n)return!1;const l=Date.now(),u=new Date(d.expiresAt).getTime();return l<u},getCardLock:s=>{const{lockedCards:a,userId:n}=m(),d=a[s];if(!d)return null;const l=Date.now(),u=new Date(d.expiresAt).getTime();return l>=u?null:{...d,isOwnLock:d.userId===n}},createEpic:async(s,a,n)=>{const{apiCall:d,connected:l}=m();if(l)try{return(await d("/epic/create",{name:s,description:a,projectKey:n})).epicId}catch(u){return r({error:u.message}),null}return null},updateEpic:async(s,a)=>{const{apiCall:n,connected:d}=m();if(d)try{return await n("/epic/update",{epicId:s,patch:a}),!0}catch(l){return r({error:l.message}),!1}return!1},setSelectedCard:s=>r({selectedCardId:s}),setCardBeingEdited:s=>r({cardBeingEdited:s}),clearError:()=>r({error:null}),getActiveBoard:()=>{var n;const{state:s,activeBoardId:a}=m();return((n=s==null?void 0:s.boards)==null?void 0:n.find(d=>d.id===a))||null},getEpics:()=>{const{state:s}=m();return(s==null?void 0:s.epics)||[]},getCardsByStatus:s=>{const a=m().getActiveBoard();if(!a)return[];const n=a.lists.find(d=>d.statusId===s);return(n==null?void 0:n.cards)||[]},getStats:()=>{const s=m().getActiveBoard();if(!s)return{};const a={total:0,byStatus:{},totalPoints:0,completedPoints:0};for(const n of s.lists){const d=n.cards.length;a.total+=d,a.byStatus[n.statusId||n.name]=d;for(const l of n.cards)typeof l.points=="number"&&(a.totalPoints+=l.points,n.statusId==="done"&&(a.completedPoints+=l.points))}return a.completionPercent=a.totalPoints>0?Math.round(a.completedPoints/a.totalPoints*100):0,a},syncNow:async()=>{var s,a;try{const{serverBaseUrl:n}=m(),d=bs(n)||gs,l=await fetch(`${d}/api/state`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw new Error(`Sync failed (${l.status})`);const u=await l.json();return r({state:u,activeBoardId:(u==null?void 0:u.activeBoardId)||((a=(s=u==null?void 0:u.boards)==null?void 0:s[0])==null?void 0:a.id)||null,loading:!1,error:null}),u}catch(n){return r({error:(n==null?void 0:n.message)||"Failed to sync"}),null}},setUseRemoteServer:s=>{localStorage.setItem(_t,String(!!s)),r({useRemoteServer:!!s}),m().connected&&m().connect()},setServerBaseUrl:s=>{const a=bs(s)||gs;localStorage.setItem(St,a),r({serverBaseUrl:a}),m().connected&&m().connect()},setAutoConnect:s=>{localStorage.setItem("kanban-auto-connect",String(s)),r({autoConnect:s}),s&&!m().connected&&m().connect()},checkServerStatus:async()=>{const{useRemoteServer:s,serverBaseUrl:a}=m(),n=bs(a)||gs;if(s)try{const l=!!(await fetch(`${n}/api/state`,{method:"GET",headers:{"Content-Type":"application/json"}})).ok;return r({serverRunning:l}),l}catch{return r({serverRunning:!1}),!1}if(window.electronAPI){const d=await window.electronAPI.getMcpServerStatus();return r({serverRunning:d}),d}return!1},toggleServer:async()=>{if(!window.electronAPI||m().useRemoteServer)return;const{serverRunning:s}=m();s?(await window.electronAPI.stopMcpServer(),r({serverRunning:!1,connected:!1}),m().disconnect()):(await window.electronAPI.startMcpServer(),r({serverRunning:!0}),setTimeout(()=>m().connect(),1e3))}})),It=[{id:"bmad-method",name:"BMAD-Method Sprint",description:"Full agile workflow with story lifecycle",type:"bmad",lists:Js.map(r=>r.name),icon:Ds},{id:"kanban-simple",name:"Simple Kanban",description:"Basic workflow for quick projects",type:"custom",lists:["Backlog","In Progress","Done"],icon:fr},{id:"dev-workflow",name:"Development Flow",description:"Extended workflow with code review",type:"custom",lists:["Backlog","To Do","In Progress","Review","Testing","Done"],icon:Yt}],qr={backlog:bt,"ready-for-dev":Ht,"in-progress":Xt,review:gr,done:Sr},At={low:{color:"bg-slate-500",textColor:"text-slate-500",icon:"â—‹"},medium:{color:"bg-blue-500",textColor:"text-blue-500",icon:"â—"},high:{color:"bg-amber-500",textColor:"text-amber-500",icon:"â—‘"},critical:{color:"bg-red-500",textColor:"text-red-500",icon:"â—"}},Pt="bmad-scrum-agent-setup-v1",Dt="scrum-overview-tab-v1",Tt="scrum-recent-projects-v1",Rt=8,ft=[{id:"analyst",label:"ðŸ” Analyst",description:"Brainstorming, research, and product brief creation",phase:"analysis"},{id:"pm",label:"ðŸ“‹ Product Manager",description:"PRD creation, project planning, and requirement definition",phase:"planning"},{id:"ux-designer",label:"ðŸŽ¨ UX Designer",description:"User experience design, wireframes, and user flows",phase:"planning"},{id:"architect",label:"ðŸ—ï¸ Architect",description:"Solution architecture, tech specs, and system design",phase:"solutioning"},{id:"sm",label:"ðŸ“Š Scrum Master",description:"Sprint planning, story management, and team coordination",phase:"implementation"},{id:"dev",label:"ðŸ’» Developer",description:"Story implementation, code review, and development",phase:"implementation"},{id:"tech-writer",label:"ðŸ“ Tech Writer",description:"Documentation, project context, and technical writing",phase:"implementation"},{id:"tea",label:"ðŸ§ª Test Engineer",description:"Test planning, QA, and acceptance criteria validation",phase:"implementation"},{id:"quick-flow-solo-dev",label:"âš¡ Quick Flow (Solo)",description:"Streamlined solo developer workflow for small projects",phase:"all"},{id:"bmad-master",label:"ðŸŽ¯ BMAD Master",description:"Master orchestrator for multi-agent coordination",phase:"all"}],qs=[{id:"phase-1",name:"Analysis",icon:"ðŸ”",description:"Research and product brief creation",required:!1,agent:"analyst",workflows:["brainstorm-project","research","product-brief"],outputs:["brainstorm-analysis.md","product-brief.md"]},{id:"phase-2",name:"Planning",icon:"ðŸ“‹",description:"PRD and UX design (PRD required)",required:!0,agent:"pm",workflows:["prd","create-ux-design"],outputs:["PRD.md","ux-design.md"]},{id:"phase-3",name:"Solutioning",icon:"ðŸ—ï¸",description:"Architecture and story creation",required:!1,agent:"architect",workflows:["create-architecture","create-epics-and-stories","check-implementation-readiness"],outputs:["solution-architecture.md","epics-and-stories.md"]},{id:"phase-4",name:"Implementation",icon:"ðŸ’»",description:"Sprint execution and delivery",required:!1,agent:"sm",workflows:["sprint-planning","dev-story","code-review","retrospective"],outputs:[]}],mt=[{id:"brainstorm-project",name:"Brainstorm Project",phase:"phase-1",agent:"analyst",description:"Guided brainstorming to define the project"},{id:"research",name:"Research",phase:"phase-1",agent:"analyst",description:"Market and technical research"},{id:"product-brief",name:"Product Brief",phase:"phase-1",agent:"analyst",description:"Create product concept brief"},{id:"prd",name:"PRD",phase:"phase-2",agent:"pm",description:"Product Requirements Document (required)",required:!0},{id:"create-ux-design",name:"UX Design",phase:"phase-2",agent:"ux-designer",description:"User experience design"},{id:"create-architecture",name:"Architecture",phase:"phase-3",agent:"architect",description:"Solution architecture design"},{id:"create-epics-and-stories",name:"Epics & Stories",phase:"phase-3",agent:"architect",description:"Create epics and user stories"},{id:"check-implementation-readiness",name:"Implementation Readiness",phase:"phase-3",agent:"architect",description:"Verify ready for implementation"},{id:"sprint-planning",name:"Sprint Planning",phase:"phase-4",agent:"sm",description:"Plan sprint backlog"},{id:"dev-story",name:"Develop Story",phase:"phase-4",agent:"dev",description:"Implement a user story"},{id:"code-review",name:"Code Review",phase:"phase-4",agent:"dev",description:"Review and approve code changes"},{id:"retrospective",name:"Retrospective",phase:"phase-4",agent:"sm",description:"Sprint retrospective"},{id:"bmad-quick-flow",name:"Quick Flow",phase:"all",agent:"quick-flow-solo-dev",description:"Streamlined solo dev workflow"},{id:"document-project",name:"Document Project",phase:"all",agent:"tech-writer",description:"Generate project documentation"},{id:"generate-project-context",name:"Generate Context",phase:"all",agent:"bmad-master",description:"Generate project context file"}],se={NOT_CHECKED:"not-checked",CHECKING:"checking",NOT_INSTALLED:"not-installed",INSTALLED:"installed",PARTIAL:"partial",ERROR:"error"},Et=ft,Kr=[{id:"claude-code",label:"Claude Code"},{id:"cursor",label:"Cursor"},{id:"windsurf",label:"Windsurf"},{id:"vscode",label:"VS Code"},{id:"trae",label:"Trae"},{id:"cline",label:"Cline"},{id:"copilot",label:"GitHub Copilot"}],Ps=[{id:"bmad-docs",label:"BMAD Documents",icon:"ðŸ“‹",description:"Core BMAD workflow documents",items:[{id:"prd",label:"PRD",path:"_bmad-output/prd.md",required:!0},{id:"product-brief",label:"Product Brief",path:"_bmad-output/product-brief.md"},{id:"research",label:"Research",path:"_bmad-output/research.md"},{id:"brainstorm",label:"Brainstorm",path:"_bmad-output/brainstorm.md"},{id:"tech-spec",label:"Tech Spec",path:"_bmad-output/tech-spec.md"},{id:"architecture",label:"Architecture",path:"_bmad-output/architecture.md"},{id:"ux-design",label:"UX Design",path:"_bmad-output/ux-design.md"},{id:"stories",label:"Stories",path:"_bmad-output/stories.md"}]},{id:"agent-rules",label:"Agent Rules",icon:"ðŸ¤–",description:"IDE/Agent instruction files (from agent-rules.ts)",items:[{id:"agents-md",label:"AGENTS.md (Base)",path:"AGENTS.md"},{id:"claude-md",label:"CLAUDE.md",path:"CLAUDE.md",ide:"claude-code"},{id:"gemini-md",label:"GEMINI.md",path:"GEMINI.md",ide:"gemini"},{id:"qwen-md",label:"QWEN.md",path:"QWEN.md",ide:"qwen"},{id:"cursor-rules",label:".cursorrules",path:".cursorrules",ide:"cursor"},{id:"windsurf-rules",label:".windsurfrules",path:".windsurfrules",ide:"windsurf"},{id:"cline-rules",label:".clinerules",path:".clinerules",ide:"cline"},{id:"trae-rules",label:"Trae Rules",path:".trae/rule/main.md",ide:"trae"},{id:"copilot-instructions",label:"Copilot Instructions",path:".github/copilot-instructions.md",ide:"copilot"}]},{id:"project-config",label:"Project Config",icon:"âš™ï¸",description:"Project configuration files",items:[{id:"spec-md",label:"SPEC.md",path:"SPEC.md"},{id:"readme",label:"README.md",path:"README.md"},{id:"changelog",label:"CHANGELOG.md",path:"CHANGELOG.md"},{id:"contributing",label:"CONTRIBUTING.md",path:"CONTRIBUTING.md"}]},{id:"bmad-config",label:"BMAD Config",icon:"ðŸ”§",description:"BMAD method configuration",items:[{id:"bmad-config",label:"BMAD Config",path:"_bmad/config.yaml"},{id:"bmad-agents",label:"BMAD Agents",path:"_bmad/agents/"},{id:"bmad-workflows",label:"BMAD Workflows",path:"_bmad/workflows/"}]}];Ps.flatMap(r=>r.items.map(m=>({...m,category:r.id,categoryLabel:r.label})));const Mt=[{id:"scrum_get_state",label:"scrum_get_state",description:"Read the full Scrum/Kanban state."},{id:"scrum_set_state",label:"scrum_set_state",description:"Replace the full state (use carefully)."},{id:"scrum_create_board",label:"scrum_create_board",description:"Create a new board."},{id:"scrum_delete_board",label:"scrum_delete_board",description:"Delete a board by id."},{id:"scrum_add_list",label:"scrum_add_list",description:"Add a list/status column to a board."},{id:"scrum_rename_list",label:"scrum_rename_list",description:"Rename a list/status column."},{id:"scrum_delete_list",label:"scrum_delete_list",description:"Delete a list/status column."},{id:"scrum_add_card",label:"scrum_add_card",description:"Create a story in a list."},{id:"scrum_update_card",label:"scrum_update_card",description:"Update a story fields/metadata."},{id:"scrum_delete_card",label:"scrum_delete_card",description:"Delete a story."},{id:"scrum_move_card",label:"scrum_move_card",description:"Move/reorder a story between lists."},{id:"scrum_acquire_lock",label:"scrum_acquire_lock",description:"Lock a story to prevent edits."},{id:"scrum_release_lock",label:"scrum_release_lock",description:"Release a story lock."},{id:"scrum_create_epic",label:"scrum_create_epic",description:"Create an epic."},{id:"scrum_update_epic",label:"scrum_update_epic",description:"Update an epic."},{id:"scrum_get_stories_by_status",label:"scrum_get_stories_by_status",description:"List stories in a status."},{id:"scrum_get_next_story",label:"scrum_get_next_story",description:"Get next story from ready-for-dev."},{id:"scrum_get_story_by_id",label:"scrum_get_story_by_id",description:"Get a story by key (board:name:number) or UUID."},{id:"scrum_complete_story",label:"scrum_complete_story",description:"Move a story to done and release lock."},{id:"bmad_install",label:"bmad_install",description:"Install BMAD in a project directory."},{id:"bmad_status",label:"bmad_status",description:"Check BMAD installation status."},{id:"generate_prd",label:"generate_prd",description:"Generate PRD markdown into a file."},{id:"update_prd",label:"update_prd",description:"Overwrite an existing PRD markdown file."},{id:"add_prd_features",label:"add_prd_features",description:"Add feature bullets into a PRD section."},{id:"context_list_files",label:"context_list_files",description:"List BMAD context files and check which exist."},{id:"context_read",label:"context_read",description:"Read a BMAD context file (PRD, agent rules, etc.)."},{id:"context_write",label:"context_write",description:"Write content to a BMAD context file."}],Bt=({toolId:r,activeBoard:m,projectRoot:s})=>{var b,x,h,f,C,N;const a=(m==null?void 0:m.id)||"<boardId>",n=(m==null?void 0:m.name)||"<boardName>",d=((x=(b=m==null?void 0:m.lists)==null?void 0:b[0])==null?void 0:x.id)||"<listId>",l=((N=(C=(f=(h=m==null?void 0:m.lists)==null?void 0:h[0])==null?void 0:f.cards)==null?void 0:C[0])==null?void 0:N.id)||"<cardId>",u=String(s||"").trim()||"/absolute/path";switch(r){case"scrum_get_state":return"scrum-kanban/scrum_get_state";case"scrum_set_state":return'scrum-kanban/scrum_set_state {"state":{...}}';case"scrum_create_board":return'scrum-kanban/scrum_create_board {"name":"","type":"bmad"}';case"scrum_delete_board":return`scrum-kanban/scrum_delete_board {"boardId":"${a}"}`;case"scrum_add_list":return`scrum-kanban/scrum_add_list {"boardId":"${a}","name":"Backlog"}`;case"scrum_rename_list":return`scrum-kanban/scrum_rename_list {"boardId":"${a}","listId":"${d}","name":"New name"}`;case"scrum_delete_list":return`scrum-kanban/scrum_delete_list {"boardId":"${a}","listId":"${d}"}`;case"scrum_add_card":return`scrum-kanban/scrum_add_card {"boardId":"${a}","listId":"${d}","title":"My story"}`;case"scrum_update_card":return`scrum-kanban/scrum_update_card {"boardId":"${a}","listId":"${d}","cardId":"${l}","patch":{...}}`;case"scrum_delete_card":return`scrum-kanban/scrum_delete_card {"boardId":"${a}","listId":"${d}","cardId":"${l}"}`;case"scrum_move_card":return`scrum-kanban/scrum_move_card {"boardId":"${a}","cardId":"${l}","fromListId":"${d}","toListId":"<toListId>","toIndex":0}`;case"scrum_acquire_lock":return`scrum-kanban/scrum_acquire_lock {"cardId":"${l}"}`;case"scrum_release_lock":return`scrum-kanban/scrum_release_lock {"cardId":"${l}"}`;case"scrum_create_epic":return'scrum-kanban/scrum_create_epic {"name":"Epic name"}';case"scrum_update_epic":return'scrum-kanban/scrum_update_epic {"epicId":"<epicId>","patch":{...}}';case"scrum_get_stories_by_status":return`scrum-kanban/scrum_get_stories_by_status {"boardId":"${a}","status":"backlog"}`;case"scrum_get_next_story":return`scrum-kanban/scrum_get_next_story {"boardId":"${a}"}`;case"scrum_get_story_by_id":return`scrum-kanban/scrum_get_story_by_id here is id: ${n}:1`;case"scrum_complete_story":return`scrum-kanban/scrum_complete_story {"boardId":"${a}","cardId":"${l}"}`;case"bmad_install":return`scrum-kanban/bmad_install {"cwd":"${u}","mode":"npx"}`;case"bmad_status":return`scrum-kanban/bmad_status {"cwd":"${u}","mode":"npx"}`;case"generate_prd":return`scrum-kanban/generate_prd {"cwd":"${u}","content":"..."}`;case"update_prd":return`scrum-kanban/update_prd {"cwd":"${u}","relativePath":"_bmad-output/prd.md","content":"..."}`;case"add_prd_features":return`scrum-kanban/add_prd_features {"cwd":"${u}","relativePath":"_bmad-output/prd.md","headingPath":["Core Features (MVP)"],"features":["..."],"createIfMissing":true}`;default:return`scrum-kanban/${String(r||"<tool>")}`}},Lt=r=>{try{return JSON.parse(r)}catch{return null}},Jr=r=>String(r||"").replace(/\\/g,"/"),Hr=({teamSize:r,sprintLength:m,autoSync:s})=>{const a=Number(r),n=Number(m),d=!!s;return Number.isFinite(a)&&a>=8?"bmad-master":Number.isFinite(n)&&n>=21||d?"sm":"quick-flow-solo-dev"},ut=r=>String(r||"").split(/(`[^`]*`)/g).filter(a=>a!=="").map((a,n)=>a.startsWith("`")&&a.endsWith("`")&&a.length>=2?e.jsx("code",{className:"rounded bg-white/10 px-1 py-0.5 font-mono text-[12px]",children:a.slice(1,-1)},`${n}:${a}`):e.jsx(c.Fragment,{children:a},`${n}:${a}`)),Xr=({value:r})=>{const s=String(r||"").replace(/\r\n/g,`
`).split(`
`),a=[];let n=0,d=!1,l=[];const u=()=>{l.length&&(a.push({type:"code",text:l.join(`
`)}),l=[])};for(;n<s.length;){const x=String(s[n]||""),h=x.trim();if(h.startsWith("```")){d?(u(),d=!1):d=!0,n++;continue}if(d){l.push(x),n++;continue}const f=x.match(/^(#{1,6})\s+(.*)$/);if(f){a.push({type:"heading",level:f[1].length,text:String(f[2]||"").trim()}),n++;continue}if(x.match(/^\s*[-*+]\s+(.*)$/)){const y=[];for(;n<s.length;){const U=String(s[n]||"").match(/^\s*[-*+]\s+(.*)$/);if(!U)break;y.push(String(U[1]||"").trim()),n++}a.push({type:"ul",items:y});continue}if(!h){a.push({type:"spacer"}),n++;continue}const N=[h];for(n++;n<s.length;){const y=String(s[n]||""),R=y.trim();if(!R||/^(#{1,6})\s+/.test(y)||/^\s*[-*+]\s+/.test(R)||R.startsWith("```"))break;N.push(R),n++}a.push({type:"p",text:N.join(" ")})}d&&u();const b=x=>x<=1?"text-xl font-semibold":x===2?"text-lg font-semibold":x===3?"text-base font-semibold":"text-sm font-semibold";return e.jsx("div",{className:"text-sm text-gray-100 whitespace-normal",children:a.map((x,h)=>{const f=`${h}:${x.type}:${String(x.text||"")}`;return x.type==="spacer"?e.jsx("div",{className:"h-2"},f):x.type==="heading"?e.jsx("div",{className:$("mt-3",b(x.level)),children:ut(x.text)},f):x.type==="code"?e.jsx("pre",{className:"mt-3 rounded-md border border-border/50 bg-black/60 p-3 overflow-x-auto text-xs",children:e.jsx("code",{className:"font-mono",children:x.text})},f):x.type==="ul"?e.jsx("ul",{className:"mt-2 list-disc pl-5 space-y-1",children:x.items.map((C,N)=>e.jsx("li",{children:ut(C)},`${N}:${C}`))},f):x.type==="p"?e.jsx("p",{className:"mt-2 leading-6",children:ut(x.text)},f):null})})},Yr=({docs:r,prdPath:m,selectedIdes:s})=>{const a={id:"prd",label:"PRD",path:String(m||"_bmad-output/prd.md").trim()||"_bmad-output/prd.md",category:"bmad-docs",required:!0},d=(Array.isArray(r)?r:[]).map(l=>({id:String((l==null?void 0:l.id)||"").trim(),label:String((l==null?void 0:l.label)||"").trim()||"Context",path:String((l==null?void 0:l.path)||"").trim(),category:String((l==null?void 0:l.category)||"custom").trim()})).filter(l=>l.id&&l.id!=="prd");return[a,...d]},Qr=({selectedIdes:r,includeAll:m=!1})=>{const s=new Set(Array.isArray(r)?r:[]),a=[];for(const n of Ps)for(const d of n.items)d.ide&&!m&&s.size>0&&!s.has(d.ide)||a.push({...d,category:n.id,categoryLabel:n.label,categoryIcon:n.icon});return a},Zr=({open:r,onOpenChange:m,initial:s,onSave:a,onDelete:n,epics:d=[],isLocked:l=!1,lockInfo:u=null})=>{const[b,x]=c.useState((s==null?void 0:s.title)||""),[h,f]=c.useState((s==null?void 0:s.description)||""),[C,N]=c.useState((s==null?void 0:s.assignee)||""),[y,R]=c.useState(typeof(s==null?void 0:s.points)=="number"?String(s.points):""),[U,te]=c.useState(Array.isArray(s==null?void 0:s.labels)?s.labels.join(", "):""),[G,z]=c.useState((s==null?void 0:s.priority)||"medium"),[de,ae]=c.useState((s==null?void 0:s.epicId)||"");c.useEffect(()=>{x((s==null?void 0:s.title)||""),f((s==null?void 0:s.description)||""),N((s==null?void 0:s.assignee)||""),R(typeof(s==null?void 0:s.points)=="number"?String(s.points):""),te(Array.isArray(s==null?void 0:s.labels)?s.labels.join(", "):""),z((s==null?void 0:s.priority)||"medium"),ae((s==null?void 0:s.epicId)||"")},[s]);const Y=b.trim().length>0&&!l;return e.jsx(fs,{open:r,onOpenChange:m,children:e.jsxs(js,{className:"sm:max-w-[500px] bg-background/95 backdrop-blur-lg border-border/50",children:[e.jsxs(vs,{children:[e.jsx(ws,{className:"flex items-center gap-2",children:s!=null&&s.id?e.jsxs(e.Fragment,{children:[e.jsx(Qt,{className:"h-5 w-5 text-primary"}),"Edit Story"]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-5 w-5 text-primary"}),"Create New Story"]})}),l&&u&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-amber-500/10 border border-amber-500/30 rounded-lg text-sm",children:[e.jsx(Ft,{className:"h-4 w-4 text-amber-500"}),e.jsxs("span",{className:"text-amber-600 dark:text-amber-400",children:["This card is being edited by ",u.userId]})]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx($r,{className:"h-4 w-4 text-muted-foreground"}),"Title"]}),e.jsx(L,{value:b,onChange:P=>x(P.target.value),placeholder:"Enter story title...",className:"bg-background/50",disabled:l})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Kt,{className:"h-4 w-4 text-muted-foreground"}),"Description"]}),e.jsx("textarea",{className:"flex min-h-[100px] w-full rounded-lg border border-input bg-background/50 px-3 py-2 text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 resize-none",value:h,onChange:P=>f(P.target.value),placeholder:"Describe the story requirements...",disabled:l})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Zt,{className:"h-4 w-4 text-muted-foreground"}),"Assignee"]}),e.jsx(L,{value:C,onChange:P=>N(P.target.value),placeholder:"Who's working on this?",className:"bg-background/50",disabled:l})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-4 w-4 text-muted-foreground"}),"Story Points"]}),e.jsx(L,{inputMode:"numeric",value:y,onChange:P=>R(P.target.value),placeholder:"e.g. 3",className:"bg-background/50",disabled:l})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:"h-4 w-4 text-muted-foreground"}),"Priority"]}),e.jsxs(ce,{value:G,onValueChange:z,disabled:l,children:[e.jsx(oe,{className:"bg-background/50",children:e.jsx(le,{})}),e.jsx(ie,{children:Wr.map(P=>e.jsx(B,{value:P.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:$("w-2 h-2 rounded-full",`bg-[${P.color}]`),style:{backgroundColor:P.color}}),P.name]})},P.id))})]})]}),d.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Yt,{className:"h-4 w-4 text-muted-foreground"}),"Epic"]}),e.jsxs(ce,{value:de,onValueChange:ae,disabled:l,children:[e.jsx(oe,{className:"bg-background/50",children:e.jsx(le,{placeholder:"Select epic..."})}),e.jsxs(ie,{children:[e.jsx(B,{value:"",children:"No Epic"}),d.map(P=>e.jsx(B,{value:P.id,children:P.name},P.id))]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Br,{className:"h-4 w-4 text-muted-foreground"}),"Labels"]}),e.jsx(L,{value:U,onChange:P=>te(P.target.value),placeholder:"feature, bugfix, enhancement (comma separated)",className:"bg-background/50",disabled:l})]})]}),e.jsxs(Ns,{className:"gap-2",children:[(s==null?void 0:s.id)&&!l&&e.jsxs(w,{type:"button",variant:"destructive",className:"mr-auto",onClick:()=>n==null?void 0:n(),children:[e.jsx(Xs,{className:"h-4 w-4 mr-2"}),"Delete"]}),e.jsx(w,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(w,{type:"button",disabled:!Y,onClick:()=>{const P=y.trim()===""?null:Number(y),Q=Number.isFinite(P)?P:null,ke=U.split(",").map(O=>O.trim()).filter(Boolean);a({title:b.trim(),description:h.trim(),assignee:C.trim(),points:Q,labels:ke,priority:G,epicId:de||null})},className:"bg-primary hover:bg-primary/90",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),s!=null&&s.id?"Update Story":"Create Story"]})]})]})})},ea=({stats:r})=>{var m,s;return e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-gradient-to-br from-blue-500/10 to-blue-600/5 border border-blue-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(zt,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Stories"})]}),e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r.total||0})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-gradient-to-br from-amber-500/10 to-amber-600/5 border border-amber-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Xt,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"In Progress"})]}),e.jsx("div",{className:"text-2xl font-bold text-foreground",children:((m=r.byStatus)==null?void 0:m["in-progress"])||0})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-gradient-to-br from-green-500/10 to-green-600/5 border border-green-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ss,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Completed"})]}),e.jsx("div",{className:"text-2xl font-bold text-foreground",children:((s=r.byStatus)==null?void 0:s.done)||0})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-gradient-to-br from-purple-500/10 to-purple-600/5 border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(zr,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Progress"})]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[r.completionPercent||0,"%"]}),r.totalPoints>0&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[r.completedPoints,"/",r.totalPoints," pts"]})]})]})},sa=({activeBoard:r,projectRoot:m})=>{const[s,a]=c.useState("scrum_get_state"),[n,d]=c.useState(!1),l=c.useMemo(()=>Mt.find(h=>h.id===s)||null,[s]),u=c.useMemo(()=>Bt({toolId:s,activeBoard:r,projectRoot:m}),[s,r,m]),b=c.useCallback(async h=>{const f=typeof h=="string"?h:u;if(f)try{await navigator.clipboard.writeText(f),d(!0),Ct.success("Usage instructions copied to clipboard",{description:"You can now paste them into your AI agent's chat."}),setTimeout(()=>d(!1),2e3)}catch{Ct.error("Failed to copy to clipboard")}},[u]),x=h=>{a(h);const f=Bt({toolId:h,activeBoard:r,projectRoot:m});b(f)};return e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"MCP tool"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:l==null?void 0:l.description})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(ce,{value:s,onValueChange:x,children:[e.jsx(oe,{className:"w-[260px] bg-background/50",onClick:()=>b(),children:e.jsx(le,{placeholder:"Select tool"})}),e.jsx(ie,{children:Mt.map(h=>e.jsx(B,{value:h.id,children:e.jsxs("div",{className:"grid",children:[e.jsx("div",{className:"text-sm leading-tight",children:h.label}),h.description?e.jsx("div",{className:"text-xs text-muted-foreground leading-tight",children:h.description}):null]})},h.id))})]})})]}),e.jsx("div",{className:"mt-3 rounded-lg border border-border/50 bg-background/60 px-3 py-2 font-mono text-xs whitespace-pre-wrap break-words cursor-pointer hover:bg-background/80 transition-colors",onClick:()=>b(),children:u})]})},ta=({card:r,onClick:m,onDragStart:s,onDragEnd:a,isLocked:n,lockInfo:d,listColor:l,storyKey:u,isDragging:b})=>{const[x,h]=c.useState(!1),f=At[r.priority]||At.medium,C=c.useCallback(async N=>{if(N&&(N.preventDefault(),N.stopPropagation()),!u)return;const y=`scrum-kanban/scrum_get_story_by_id here is id: ${u}`;try{await navigator.clipboard.writeText(y),h(!0),setTimeout(()=>h(!1),2e3)}catch{}},[u]);return e.jsx(Wt,{draggable:!n,onDragStart:s,onDragEnd:a,className:$("cursor-grab active:cursor-grabbing transition-all duration-300 ease-in-out group","hover:shadow-lg hover:shadow-primary/5 hover:border-primary/30","bg-card/50 backdrop-blur-sm border-border/50",n&&"opacity-60 cursor-not-allowed ring-2 ring-amber-500/50",b&&"opacity-20 scale-95 border-primary/40 grayscale shadow-none"),children:e.jsxs(Vt,{className:"p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("button",{type:"button",className:"flex-1 text-left",onClick:N=>{C(N),m(N)},disabled:n,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full shrink-0",style:{backgroundColor:l||"#6b7280"}}),u&&e.jsxs(q,{variant:"outline",className:"text-[10px] px-1.5 py-0 tabular-nums shrink-0",children:["#",u.split(":").pop()]}),e.jsx("span",{className:"font-medium text-sm text-foreground leading-snug line-clamp-2",children:r.title})]}),r.description&&e.jsx("div",{className:"text-xs text-muted-foreground line-clamp-2 mt-1.5 pl-3.5",children:r.description})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[u&&e.jsx(w,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 opacity-0 group-hover:opacity-100 hover:opacity-100",onClick:C,disabled:!u,children:x?e.jsx(wr,{className:"h-3.5 w-3.5 text-green-500"}):e.jsx(Ze,{className:"h-3.5 w-3.5"})}),n?e.jsx(xt,{children:e.jsxs(pt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx("div",{className:"p-1.5 rounded-full bg-amber-500/10",children:e.jsx(Ft,{className:"h-3.5 w-3.5 text-amber-500"})})}),e.jsxs(gt,{children:["Being edited by ",(d==null?void 0:d.userId)||"another user"]})]})}):e.jsx(w,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 opacity-0 group-hover:opacity-100 hover:opacity-100",onClick:m,children:e.jsx(Qt,{className:"h-3.5 w-3.5"})})]})]}),(r.assignee||r.points!==null||r.labels&&r.labels.length||r.priority)&&e.jsxs("div",{className:"mt-2.5 pt-2.5 border-t border-border/30 flex flex-wrap items-center gap-1.5",children:[r.priority&&r.priority!=="medium"&&e.jsx(q,{variant:"secondary",className:$("text-[10px] px-1.5 py-0",f.textColor),children:r.priority}),typeof r.points=="number"&&e.jsxs(q,{variant:"secondary",className:"text-[10px] px-1.5 py-0 bg-primary/10 text-primary",children:[r.points," pt"]}),r.assignee&&e.jsxs(q,{variant:"outline",className:"text-[10px] px-1.5 py-0",children:[e.jsx(Zt,{className:"h-2.5 w-2.5 mr-1"}),r.assignee]}),Array.isArray(r.labels)&&r.labels.slice(0,2).map(N=>e.jsx(q,{className:"text-[10px] px-1.5 py-0 bg-secondary text-secondary-foreground",children:N},N)),r.labels&&r.labels.length>2&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["+",r.labels.length-2]})]})]})})},$t=({isActive:r,onDrop:m})=>{const[s,a]=c.useState(!1);return e.jsx("div",{role:"presentation","aria-hidden":"true",className:$("rounded-lg transition-all duration-200 ease-out relative w-full",r?s?"h-24 bg-primary/15 border-2 border-dashed border-primary/40 shadow-sm my-2":"h-6 bg-primary/5 hover:h-24 hover:bg-primary/10 my-1":"h-0 opacity-0 overflow-hidden m-0"),onDragOver:n=>{n.preventDefault(),r&&a(!0)},onDragLeave:()=>a(!1),onDrop:n=>{a(!1),m(n)},children:r&&e.jsx("div",{className:$("absolute inset-0 flex items-center justify-center text-[10px] font-medium uppercase tracking-wider transition-opacity duration-200",s?"text-primary/60 opacity-100":"opacity-0"),children:s?"Drop here":""})})},ra=({list:r,listDrop:m,onDragOverList:s,onDropList:a,onDragStartList:n,onDragEndList:d,dragState:l,onAddCard:u,onEditCard:b,onRename:x,onDelete:h,onDragStartCard:f,onDragEndCard:C,onDropToIndex:N,onDropToEnd:y,isCardLocked:R,getCardLock:U,storyKeyByCardId:te})=>{const[G,z]=c.useState(!1),[de,ae]=c.useState(r.name),Y=(l==null?void 0:l.type)==="card",P=Y&&(l==null?void 0:l.listId)===r.id,Q=(l==null?void 0:l.type)==="list"&&(m==null?void 0:m.overListId)===r.id,ke=qr[r.statusId]||bt;return c.useEffect(()=>{ae(r.name)},[r.name]),e.jsxs("div",{role:"presentation",className:$("relative w-[320px] rounded-xl border bg-background/50 backdrop-blur-sm flex flex-col h-full min-h-0","border-border/50 hover:border-border transition-all duration-300",Q&&"ring-2 ring-primary/30"),onDragOver:s,onDrop:a,children:[Q&&e.jsx("div",{"aria-hidden":"true",className:$("absolute inset-y-2 w-1 rounded bg-primary/50",(m==null?void 0:m.position)==="after"?"right-0":"left-0")}),e.jsxs("div",{className:"px-3 py-3 border-b border-border/30 flex items-center gap-2",style:{borderTopColor:r.color||"#6b7280",borderTopWidth:3,borderTopLeftRadius:12,borderTopRightRadius:12},children:[e.jsx("div",{draggable:!G,className:$("shrink-0 rounded p-1 -ml-1 text-muted-foreground",G?"cursor-not-allowed opacity-40":"cursor-grab active:cursor-grabbing hover:text-foreground"),onDragStart:n,onDragEnd:d,onClick:O=>O.stopPropagation(),children:e.jsx(br,{className:"h-4 w-4"})}),e.jsx(ke,{className:"h-4 w-4 shrink-0",style:{color:r.color||"#6b7280"}}),G?e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(L,{className:"h-7 text-sm bg-background/50",value:de,onChange:O=>ae(O.target.value),onKeyDown:O=>{O.key==="Enter"&&(x(de),z(!1)),O.key==="Escape"&&(ae(r.name),z(!1))},autoFocus:!0}),e.jsx(w,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>{x(de),z(!1)},children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx(w,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>{ae(r.name),z(!1)},children:e.jsx(Gt,{className:"h-4 w-4"})})]}):e.jsx("button",{type:"button",className:"flex-1 text-left font-medium text-foreground truncate text-sm hover:text-primary transition-colors",onClick:()=>z(!0),children:r.name}),e.jsx(q,{variant:"secondary",className:"text-xs tabular-nums",style:{backgroundColor:`${r.color}20`,color:r.color,borderColor:r.color},children:r.cards.length}),e.jsx(xt,{children:e.jsxs(pt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(w,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",onClick:u,children:e.jsx(be,{className:"h-4 w-4"})})}),e.jsx(gt,{children:"Add new story"})]})}),e.jsx(xt,{children:e.jsxs(pt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(w,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 hover:text-destructive",onClick:h,children:e.jsx(Xs,{className:"h-4 w-4"})})}),e.jsx(gt,{children:"Delete list"})]})})]}),e.jsx(he,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:"p-3 flex flex-col gap-2",children:[r.cards.map((O,Z)=>{const Ce=R(O.id),Se=U(O.id),ts=Y&&(l==null?void 0:l.cardId)===O.id;return e.jsxs(c.Fragment,{children:[e.jsx($t,{isActive:Y&&(!P||Z!==(l==null?void 0:l.index)&&Z!==(l==null?void 0:l.index)+1),onDrop:Me=>N(Me,Z)}),e.jsx("div",{className:"group",children:e.jsx(ta,{card:O,onClick:()=>b(O),onDragStart:Me=>f(Me,O.id,Z),onDragEnd:C,isLocked:Ce,lockInfo:Se,listColor:r.color,storyKey:te==null?void 0:te[O.id],isDragging:ts})})]},O.id)}),e.jsx($t,{isActive:Y&&(!P||(l==null?void 0:l.index)!==r.cards.length-1),onDrop:O=>N(O,r.cards.length)}),r.cards.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(bt,{className:"h-8 w-8 mx-auto mb-2 opacity-30"}),e.jsx("p",{children:"No stories yet"}),e.jsxs(w,{variant:"ghost",size:"sm",className:"mt-2",onClick:u,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Add a story"]})]})]})})]})},aa=({onAdd:r})=>{const[m,s]=c.useState(!1),[a,n]=c.useState(""),[d,l]=c.useState(!1);return e.jsx("div",{className:"w-[320px] shrink-0",children:m?e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/50 backdrop-blur-sm p-4 shadow-lg animate-in fade-in zoom-in-95 duration-200",children:[e.jsx(_,{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"New Column"}),e.jsx(L,{value:a,onChange:u=>n(u.target.value),placeholder:"Column name...",className:"mt-2 bg-background/50",onKeyDown:async u=>{if(u.key==="Enter"&&a.trim()&&!d){l(!0);try{await r(a.trim())&&(n(""),s(!1))}finally{l(!1)}}u.key==="Escape"&&(n(""),s(!1))},autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(w,{type:"button",className:"flex-1",disabled:!a.trim()||d,onClick:async()=>{if(!d){l(!0);try{await r(a.trim())&&(n(""),s(!1))}finally{l(!1)}}},children:d?"Adding...":"Add"}),e.jsx(w,{type:"button",variant:"outline",className:"flex-1",disabled:d,onClick:()=>{n(""),s(!1)},children:"Cancel"})]})]}):e.jsxs(w,{type:"button",variant:"outline",className:"w-full justify-center h-14 border-dashed border-2 border-border/50 hover:border-primary/50 hover:bg-primary/5 transition-all",onClick:()=>s(!0),children:[e.jsx(be,{className:"h-5 w-5 mr-2"}),"Add Column"]})})},na=({open:r,onOpenChange:m,onCreateBoard:s})=>{const[a,n]=c.useState(""),[d,l]=c.useState("bmad-method"),u=()=>{if(!a.trim())return;const b=It.find(x=>x.id===d);s(a.trim(),(b==null?void 0:b.type)||"custom"),n(""),m(!1)};return e.jsx(fs,{open:r,onOpenChange:m,children:e.jsxs(js,{className:"sm:max-w-[480px] bg-background/95 backdrop-blur-lg",children:[e.jsxs(vs,{children:[e.jsxs(ws,{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-5 w-5 text-primary"}),"Create New Board"]}),e.jsx(Ts,{children:"Choose a workflow template based on your project needs"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{children:"Board Name"}),e.jsx(L,{value:a,onChange:b=>n(b.target.value),placeholder:"Enter board name...",className:"bg-background/50",onKeyDown:b=>{b.key==="Enter"&&a.trim()&&u()},autoFocus:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{children:"Workflow Template"}),e.jsx("div",{className:"grid gap-2",children:It.map(b=>{const x=b.icon;return e.jsxs("button",{type:"button",className:$("p-4 rounded-xl border text-left transition-all","hover:bg-accent/50",d===b.id?"border-primary bg-primary/5 ring-2 ring-primary/30":"border-border/50 bg-background/30"),onClick:()=>{l(b.id),navigator.clipboard.writeText(b.id).catch(()=>{})},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:$("p-2 rounded-lg",d===b.id?"bg-primary/20 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(x,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:b.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:b.description})]}),d===b.id&&e.jsx(ss,{className:"h-5 w-5 text-primary"})]}),e.jsx("div",{className:"mt-2 flex items-center gap-1 flex-wrap",children:b.lists.map((h,f)=>e.jsxs(c.Fragment,{children:[e.jsx("span",{className:"text-[10px] text-muted-foreground bg-muted/50 px-1.5 py-0.5 rounded",children:h}),f<b.lists.length-1&&e.jsx(qt,{className:"h-3 w-3 text-muted-foreground/50"})]},h))})]},b.id)})})]})]}),e.jsxs(Ns,{children:[e.jsx(w,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(w,{onClick:u,disabled:!a.trim(),children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Create Board"]})]})]})})},Ot=({open:r,onOpenChange:m})=>{const{connected:s,autoConnect:a,setAutoConnect:n,serverRunning:d,toggleServer:l,checkServerStatus:u}=Hs(),[b,x]=c.useState([]),h=c.useRef(null);return c.useEffect(()=>{r&&u()},[r,u]),c.useEffect(()=>{if(window.electronAPI&&(window.electronAPI.getMcpLogs&&window.electronAPI.getMcpLogs().then(x),window.electronAPI.onMcpLog)){const f=window.electronAPI.onMcpLog(C=>{x(N=>[...N,C])});return()=>f()}},[]),c.useEffect(()=>{b[b.length-1]&&h.current&&r&&h.current.scrollIntoView({behavior:"smooth"})},[b,r]),e.jsx(fs,{open:r,onOpenChange:m,children:e.jsxs(js,{className:"sm:max-w-[600px] h-[500px] flex flex-col bg-background/95 backdrop-blur-lg",children:[e.jsxs(vs,{children:[e.jsxs(ws,{className:"flex items-center gap-2",children:[e.jsx(jt,{className:"h-5 w-5 text-primary"}),"Kanban Settings"]}),e.jsx(Ts,{children:"Configure connection or view server logs"})]}),e.jsxs(Re,{defaultValue:"general",className:"flex-1 flex flex-col min-h-0",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-2",children:[e.jsx(J,{value:"general",children:"General"}),e.jsx(J,{value:"logs",children:"Server Logs"})]}),e.jsxs(H,{value:"general",className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[e.jsxs(_,{htmlFor:"auto-connect",className:"flex flex-col gap-1",children:[e.jsx("span",{children:"Auto-Connect"}),e.jsx("span",{className:"font-normal text-xs text-muted-foreground",children:"Automatically start and connect to local MCP server"})]}),e.jsx(Ks,{id:"auto-connect",checked:a,onCheckedChange:n})]}),e.jsxs("div",{className:"space-y-4 border-t border-border/50 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium leading-none",children:"Local Server Control"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manually control the background MCP process"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border/50 bg-secondary/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:$("w-2.5 h-2.5 rounded-full shrink-0 transition-colors",s?"bg-green-500 animate-pulse":"bg-destructive")}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:s?d?"Online (Internal)":"Online (External)":"Server Offline"}),!s&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:d?"Process running, no connection":"Process stopped"})]})]}),e.jsx(w,{variant:d?"destructive":"default",size:"sm",onClick:l,children:d?e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"h-4 w-4 mr-2"}),"Stop Internal"]}):e.jsxs(e.Fragment,{children:[e.jsx(er,{className:"h-4 w-4 mr-2"}),"Start Internal"]})})]})]})]}),e.jsx(H,{value:"logs",className:"flex-1 min-h-0 py-4 relative",children:e.jsx("div",{className:"absolute inset-0 top-4 bottom-0",children:e.jsx(he,{className:"h-full rounded-md border border-border bg-black/90 p-4 font-mono text-xs text-green-400",children:e.jsxs("div",{className:"space-y-1",children:[b.length===0&&e.jsx("div",{className:"text-muted-foreground italic",children:"No logs captured yet..."}),b.map((f,C)=>e.jsxs("div",{className:"flex gap-2 text-wrap break-all",children:[e.jsxs("span",{className:"text-muted-foreground shrink-0",children:["[",new Date(f.timestamp).toLocaleTimeString(),"]"]}),e.jsx("span",{className:$(f.type==="error"?"text-red-400":f.type==="success"?"text-green-400":"text-gray-300"),children:f.message})]},`${f.timestamp}-${f.type}-${f.message}`)),e.jsx("div",{ref:h})]})})})})]}),e.jsx(Ns,{children:e.jsx(w,{onClick:()=>m(!1),children:"Done"})})]})})},ca=({open:r,onOpenChange:m,setup:s,onChangeSetup:a,activeBoard:n,stats:d,onCreateStory:l,onOpenStory:u,onStartStory:b})=>{var yt,kt;const{connected:x,serverRunning:h,toggleServer:f,checkServerStatus:C,syncNow:N,useRemoteServer:y,serverBaseUrl:R,setUseRemoteServer:U,setServerBaseUrl:te}=Hs(),[G,z]=c.useState("bmad"),[de,ae]=c.useState(!1),[Y,P]=c.useState(null),Q=c.useRef(null),[ke,O]=c.useState([]),[Z,Ce]=c.useState(!1),[Se,ts]=c.useState(""),[Me,_e]=c.useState(!1),[F,xe]=c.useState(null),[ys,Rs]=c.useState("status"),[rs,as]=c.useState(!0),[Be,ns]=c.useState("wizard"),[K,Ie]=c.useState("phase-1"),[Le,fe]=c.useState("brainstorm-project"),[je,cs]=c.useState("market"),[re,$e]=c.useState(["","",""]),[me,ks]=c.useState(""),[ne,V]=c.useState(""),[Oe,ze]=c.useState(!1),[Es,Cs]=c.useState(null),[Ms,Ss]=c.useState(null),[ue,Ae]=c.useState(!1),[ve,Fe]=c.useState([]),Ue=c.useRef(!1),[Ge,W]=c.useState("prd"),[we,os]=c.useState({}),[ls,Pe]=c.useState(!1),[Ne,We]=c.useState(null),Ve=c.useRef(new Set),[Ys,Qs]=c.useState("bmad-docs"),[Zs,et]=c.useState({}),[Bs,Ls]=c.useState(!1),[_s,Is]=c.useState(""),[is,$s]=c.useState(""),[Os,st]=c.useState("custom"),[ye,De]=c.useState(se.NOT_CHECKED),[qe,zs]=c.useState({core:!1,bmm:!1,_config:!1}),[ds,Ke]=c.useState("phase-1"),[ms,Fs]=c.useState({"phase-1":{completed:!1,outputs:[]},"phase-2":{completed:!1,outputs:[]},"phase-3":{completed:!1,outputs:[]},"phase-4":{completed:!1,outputs:[]}}),[us,Us]=c.useState("prd"),[Je,o]=c.useState(!1),[j,v]=c.useState(""),S=c.useMemo(()=>Hr({teamSize:s.teamSize,sprintLength:s.sprintLength,autoSync:s.autoSync}),[s.teamSize,s.sprintLength,s.autoSync]),k=s.agent||S;c.useEffect(()=>{var i;if(!r||!((i=window.electronAPI)!=null&&i.getProjectRoot))return;let t=!1;return(async()=>{try{const g=await window.electronAPI.getProjectRoot();if(t)return;v(String(g||"").trim())}catch{if(t)return;v("")}})(),()=>{t=!0}},[r]);const E=c.useMemo(()=>{const t=String(j||"").trim().replace(/[\\/]+$/,"");return t?Jr(`${t}/scripts/scrum-mcp-server.js`):""},[j]),xs=c.useMemo(()=>{if(y){const i=String(R||"").trim().replace(/[\\/]+$/,""),g=i?`${i}/mcp`:"<server-base-url>/mcp";return JSON.stringify({"scrum-kanban":{url:g}},null,2)}return JSON.stringify({"scrum-kanban":{command:"node",args:E?[E]:["<mcp-root>/scripts/scrum-mcp-server.js"],env:{SCRUM_MCP_PORT:"3847"}}},null,2)},[E,R,y]),tt=c.useMemo(()=>({"scrum-manager":"/bmad-scrum-manager","scrum-quick":"/bmad-scrum-quick","scrum-analytics":"/bmad-scrum-analytics","scrum-team":"/bmad-scrum-team"})[k]||"/bmad-scrum-manager",[k]),He=c.useCallback(async(t,i)=>{try{return await navigator.clipboard.writeText(String(i||"")),P(t),Q.current&&window.clearTimeout(Q.current),Q.current=window.setTimeout(()=>P(null),1200),!0}catch{return!1}},[]),D=String(s.projectRoot||"").trim(),A=!!D,sr=c.useCallback(async()=>{var i;if(!((i=window.electronAPI)!=null&&i.selectFolder))return;const t=await window.electronAPI.selectFolder({title:"Select project root",defaultPath:D||void 0});t&&a({...s,projectRoot:t})},[a,D,s]),tr=c.useCallback(async t=>{var i;if((i=window.electronAPI)!=null&&i.runBmadCli&&A){xe(null),Ce(!0);try{await window.electronAPI.runBmadCli({cwd:D,mode:s.bmadMode||"npx",action:t,verbose:!!s.bmadVerbose})}finally{Ce(!1)}}},[A,D,s.bmadMode,s.bmadVerbose]),rr=c.useCallback(async()=>{var t;(t=window.electronAPI)!=null&&t.stopBmadCli&&await window.electronAPI.stopBmadCli()},[]),wt=c.useCallback(async()=>{var i;const t=String(Se||"");t.trim()&&(i=window.electronAPI)!=null&&i.sendBmadCliInput&&(await window.electronAPI.sendBmadCliInput({input:t,appendNewline:!0}),ts(""))},[Se]),pe=String(s.prdPath||"_bmad-output/prd.md").trim(),Te=c.useMemo(()=>Yr({docs:s.contextDocs,prdPath:pe}),[pe,s.contextDocs]);c.useEffect(()=>{Ve.current.clear(),os({}),We(null)},[D]);const rt=c.useCallback((t,i)=>{const g=String(t||"").trim();g&&os(p=>({...p,[g]:String(i??"")}))},[]),Gs=c.useCallback(async({docId:t,relativePath:i,force:g})=>{var ee;if(!((ee=window.electronAPI)!=null&&ee.readProjectFile))return;const p=String(D||"").trim(),I=String(i||"").trim(),T=String(t||"").trim();if(!(!p||!I||!T)&&!(!g&&Ve.current.has(T))){Pe(!0);try{const M=await window.electronAPI.readProjectFile({projectRoot:p,relativePath:I});if(!(M!=null&&M.success))throw new Error((M==null?void 0:M.message)||"Failed to load");rt(T,String((M==null?void 0:M.content)||"")),Ve.current.add(T),We({ok:!0,docId:T,message:"Loaded"})}catch(M){We({ok:!1,docId:T,message:(M==null?void 0:M.message)||"Failed to load"})}finally{Pe(!1)}}},[D,rt]),ar=c.useCallback(async({docId:t,relativePath:i})=>{var ee;if(!((ee=window.electronAPI)!=null&&ee.writeProjectFile))return;const g=String(D||"").trim(),p=String(i||"").trim(),I=String(t||"").trim();if(!g||!p||!I)return;const T=Object.hasOwn(we,I)&&typeof we[I]=="string"?we[I]:"";Pe(!0);try{const M=await window.electronAPI.writeProjectFile({projectRoot:g,relativePath:p,content:T,overwrite:!0});Ve.current.add(I),We({ok:!0,docId:I,message:`Saved: ${String((M==null?void 0:M.path)||p)}`})}catch(M){We({ok:!1,docId:I,message:(M==null?void 0:M.message)||"Failed to save"})}finally{Pe(!1)}},[we,D]);c.useEffect(()=>{r&&A&&G==="project"&&Te.forEach(t=>{t!=null&&t.path&&Gs({docId:t.id,relativePath:t.path,force:!1})})},[G,Te,A,Gs,r]);const at=c.useCallback(async()=>{var I;if(!((I=window.electronAPI)!=null&&I.checkPathExists))return;const t=String(D||"").trim();if(!t)return;Ls(!0);const i=Array.isArray(s.ides)?s.ides:[],g=Qr({selectedIdes:i,includeAll:!0}),p={};try{for(const T of g)try{const ee=`${t}/${T.path}`,M=await window.electronAPI.checkPathExists(ee);p[T.id]={exists:!!M,path:T.path}}catch{p[T.id]={exists:!1,path:T.path}}et(p)}finally{Ls(!1)}},[D,s.ides]);c.useEffect(()=>{r&&A&&G==="project"&&at()},[G,at,A,r]);const nt=c.useCallback(async()=>{var i;if(!((i=window.electronAPI)!=null&&i.checkPathExists))return;const t=String(D||"").trim();if(!t){De(se.NOT_CHECKED);return}De(se.CHECKING);try{const g={_bmad:await window.electronAPI.checkPathExists(`${t}/_bmad`),core:await window.electronAPI.checkPathExists(`${t}/_bmad/core`),bmm:await window.electronAPI.checkPathExists(`${t}/_bmad/bmm`),_config:await window.electronAPI.checkPathExists(`${t}/_bmad/_config`),_bmadOutput:await window.electronAPI.checkPathExists(`${t}/_bmad-output`)};zs({core:g.core,bmm:g.bmm,_config:g._config}),g._bmad&&g.core&&g.bmm?De(se.INSTALLED):g._bmad||g._bmadOutput?De(se.PARTIAL):De(se.NOT_INSTALLED)}catch(g){console.error("BMAD check failed:",g),De(se.ERROR)}},[D]),ct=c.useCallback(async()=>{var p;if(!((p=window.electronAPI)!=null&&p.checkPathExists))return;const t=String(D||"").trim();if(!t)return;const i={...ms};for(const I of qs){const T=[];for(const ee of I.outputs)await window.electronAPI.checkPathExists(`${t}/_bmad-output/${ee}`)&&T.push(ee);i[I.id]={completed:I.outputs.length>0&&T.length===I.outputs.length,outputs:T}}const g=await window.electronAPI.checkPathExists(`${t}/_bmad-output/PRD.md`);g&&(i["phase-2"]={...i["phase-2"],outputs:[...i["phase-2"].outputs,"PRD.md"],completed:!0}),Fs(i),g?i["phase-3"].completed?Ke("phase-4"):Ke("phase-3"):Ke("phase-1")},[ms,D]),nr=c.useCallback(async()=>{var t;if((t=window.electronAPI)!=null&&t.runBmadCli&&A){o(!0);try{await window.electronAPI.runBmadCli({cwd:D,mode:s.bmadMode||"npx",action:"install",verbose:!0,autoAcceptDefaults:!0}),await nt(),await ct()}catch(i){console.error("BMAD install failed:",i)}finally{o(!1)}}},[nt,ct,A,D,s.bmadMode]),cr=c.useCallback(()=>{const t=String(_s||"").trim(),i=String(is||"").trim(),g=String(Os||"custom").trim();if(!i)return;const p=`ctx_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,I=Array.isArray(s.contextDocs)?s.contextDocs:[];a({...s,contextDocs:[...I,{id:p,label:t||"Context",path:i,category:g}]}),Is(""),$s(""),st("custom"),W(p)},[_s,is,Os,a,s]),or=c.useCallback(t=>{if(!(t!=null&&t.id)||!(t!=null&&t.path))return;const i=Array.isArray(s.contextDocs)?s.contextDocs:[];if(i.some(p=>p.path===t.path))return;const g=`ctx_${t.id}_${Date.now().toString(36)}`;a({...s,contextDocs:[...i,{id:g,label:t.label,path:t.path,category:t.category||"custom"}]}),W(g)},[a,s]),lr=c.useCallback(t=>{const i=String(t||"").trim();if(!i)return;const g=(Array.isArray(s.contextDocs)?s.contextDocs:[]).filter(p=>String((p==null?void 0:p.id)||"").trim()!==i);a({...s,contextDocs:g}),Ve.current.delete(i),os(p=>{const I={...p};return delete I[i],I}),Ge===i&&W("prd")},[Ge,a,s]),Xe=c.useMemo(()=>{const t=String(D||"").replace(/[\\/]+$/,""),i=String(pe||"").replace(/^[\\/]+/,"");return t?i?`${t}/${i}`:t:i},[D,pe]),ot=c.useMemo(()=>{const t=String(ys||"status").trim()||"status";return rs&&!!Xe?`workflow ${t} --data ${Xe}`:`workflow ${t}`},[rs,Xe,ys]);c.useMemo(()=>[{key:"workflow-example-status",label:"workflow status",command:"workflow status"},{key:"workflow-example-prd",label:"workflow prd",command:"workflow prd"},{key:"workflow-example-brainstorming",label:"workflow brainstorming",command:"workflow brainstorming"},{key:"workflow-example-brainstorming-data",label:"workflow brainstorming --data",command:`workflow brainstorming --data ${Xe||"/path/to/context.md"}`}],[Xe]);const Ye=c.useMemo(()=>mt.filter(i=>i.phase===K||i.phase==="all").map(i=>({value:i.id,label:i.name})),[K]),Qe=c.useMemo(()=>{var g;return new Set(Ye.map(p=>p.value)).has(Le)?Le:((g=Ye[0])==null?void 0:g.value)||"brainstorm-project"},[Le,Ye]);c.useEffect(()=>{var g;if(new Set(Ye.map(p=>p.value)).has(Le))return;const i=((g=Ye[0])==null?void 0:g.value)||"brainstorm-project";fe(i)},[Le,Ye]),c.useEffect(()=>{ne||pe&&V(pe)},[pe,ne]);const ps=c.useMemo(()=>{const t=String(D||"").replace(/[\\/]+$/,""),i=String(ne||"").trim();if(!i)return"";if(/^(?:[a-zA-Z]:\\|\/)/.test(i))return i;const g=i.replace(/^[\\/]+/,"");return t?`${t}/${g}`:g},[D,ne]),Ws=c.useMemo(()=>{const t=String(Qe||"").trim();if(!t)return[];if(t==="research"){const i=["research"];je&&i.push("--type",String(je));const g=(re||[]).map(p=>String(p||"").trim()).filter(Boolean);for(const p of g)i.push("--input",p);return i}if(t==="product-brief"){const i=["product-brief"],g=String(me||"").trim();return g&&i.push("--input",g),i}if(t==="brainstorming"){const i=["brainstorming"];return ps&&i.push("--data",ps),i}return[t]},[Qe,ps,me,re,je]),As=c.useMemo(()=>{const t=String(Qe||"").trim();if(!t)return"";const i=[];if(t==="research"){je&&i.push(`--type ${je}`);const g=(re||[]).map(p=>String(p||"").trim()).filter(Boolean);for(const p of g)i.push(`--input ${p}`)}if(t==="product-brief"){const g=String(me||"").trim();g&&i.push(`--input ${g}`)}return t==="brainstorming"&&ps&&i.push(`--data ${ps}`),i.length?`workflow ${t} ${i.join(" ")}`:`workflow ${t}`},[Qe,ps,me,re,je]);c.useMemo(()=>Be==="wizard"?As:ot,[ot,Be,As]);const lt=c.useCallback(async()=>{var g;const t=String(D||"").trim(),i=String(ne||"").trim();if((g=window.electronAPI)!=null&&g.readProjectFile&&t&&i){if(/^(?:[a-zA-Z]:\\|\/)/.test(i)){Cs("Preview supports files inside the selected project root"),Ss(null);return}ze(!0),Cs(null);try{const p=await window.electronAPI.readProjectFile({projectRoot:t,relativePath:i});if(!(p!=null&&p.success))throw new Error((p==null?void 0:p.message)||"Failed to read file");Ss(String((p==null?void 0:p.content)||""))}catch(p){Ss(null),Cs((p==null?void 0:p.message)||"Failed to read file")}finally{ze(!1)}}},[D,ne]),ir=c.useCallback(async()=>{var t;if((t=window.electronAPI)!=null&&t.runBmadCli&&A&&Ws.length&&!ue){Fe([]),Ue.current=!0,Ae(!0);try{await window.electronAPI.runBmadCli({cwd:D,mode:s.bmadMode||"npx",action:"workflow",verbose:!!s.bmadVerbose,interactive:!0,extraArgs:Ws})}finally{Ue.current=!1,Ae(!1),ns("preview")}}},[A,D,s.bmadMode,s.bmadVerbose,Ws,ue]);c.useEffect(()=>{r&&Be==="preview"&&lt()},[r,lt,Be]);const it=c.useCallback(()=>{const t=String(s.projectName||"Project").trim()||"Project",i=String(s.projectSummary||"").trim(),g=String(s.projectGoals||"").trim(),p=String(s.projectNonGoals||"").trim(),I=String(s.projectUsers||"").trim(),T=String(s.projectSuccessMetrics||"").trim(),ee=String(s.projectConstraints||"").trim(),M=String(s.ownerName||"").trim(),dt=String(s.teamName||"").trim(),xr=String(s.teamMembers||"").trim(),pr=String(s.language||"English").trim()||"English";return[`# PRD: ${t}`,"","## Overview",i||"TBD","","## Goals",g||"TBD","","## Non-Goals",p||"TBD","","## Target Users",I||"TBD","","## Success Metrics",T||"TBD","","## Constraints",ee||"TBD","","## Team",`- Owner: ${M||"TBD"}`,`- Team: ${dt||"TBD"}`,`- Members: ${xr||"TBD"}`,`- Language: ${pr}`,"","## Notes","TBD",""].join(`
`)},[s.language,s.ownerName,s.projectConstraints,s.projectGoals,s.projectName,s.projectNonGoals,s.projectSummary,s.projectSuccessMetrics,s.projectUsers,s.teamMembers,s.teamName]),dr=c.useCallback(async()=>{var i;if(!((i=window.electronAPI)!=null&&i.writeProjectFile)||!A)return;const t=pe||"_bmad-output/prd.md";_e(!0),xe(null);try{const g=await window.electronAPI.writeProjectFile({projectRoot:D,relativePath:t,content:it(),overwrite:!0});xe({ok:!0,path:(g==null?void 0:g.path)||t})}catch(g){xe({ok:!1,message:(g==null?void 0:g.message)||"Failed"})}finally{_e(!1)}},[it,A,pe,D]);c.useEffect(()=>{if(r)return C(),()=>{Q.current&&window.clearTimeout(Q.current)}},[r,C]),c.useEffect(()=>{if(!r)return;let t;return(async()=>{var i,g;if((i=window.electronAPI)!=null&&i.getBmadLogs)try{const p=await window.electronAPI.getBmadLogs();Array.isArray(p)&&O(p)}catch{}(g=window.electronAPI)!=null&&g.onBmadLog&&(t=window.electronAPI.onBmadLog(p=>{O(I=>[...I,p].slice(-400)),Ue.current&&Fe(I=>[...I,p].slice(-400))}))})(),()=>{typeof t=="function"&&t()}},[r]);const mr=t=>{const i=new Set(Array.isArray(s.ides)?s.ides:[]);i.has(t)?i.delete(t):i.add(t),a({...s,ides:Array.from(i)})},Vs=(n==null?void 0:n.id)||null,hs=c.useMemo(()=>{var g;if(!n)return null;const t=n.lists.find(p=>p.statusId==="ready-for-dev");if(!t)return null;const i=((g=t.cards)==null?void 0:g[0])||null;return i?{listId:t.id,card:i}:null},[n]),Nt=c.useMemo(()=>{var t;return n&&((t=n.lists.find(i=>i.statusId==="in-progress"))==null?void 0:t.id)||null},[n]),ur=c.useMemo(()=>Et.map(t=>({...t,isRecommended:t.id===S,isSelected:t.id===k})),[S,k]);return e.jsx(fs,{open:r,onOpenChange:m,children:e.jsxs(js,{className:"sm:max-w-[960px] h-[75vh] max-h-[860px] min-h-[640px] flex flex-col bg-background/95 backdrop-blur-lg",children:[e.jsxs(vs,{children:[e.jsxs(ws,{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-5 w-5 text-primary"}),"BMAD Agent Assist"]}),e.jsx(Ts,{children:"Guided setup inspired by ENHANCE_SCRUM.md, without terminal steps"})]}),e.jsxs(Re,{value:G,onValueChange:z,className:"flex-1 flex flex-col min-h-0",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-4",children:[e.jsx(J,{value:"bmad",children:"BMAD"}),e.jsx(J,{value:"team",children:"Team"}),e.jsx(J,{value:"project",children:"Project"}),e.jsx(J,{value:"actions",children:"Actions"})]}),e.jsx(H,{value:"bmad",className:"flex-1 min-h-0",children:e.jsx(he,{className:"h-full",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:["ðŸŽ¯ BMAD v6 Method",ye===se.INSTALLED&&e.jsx(q,{variant:"secondary",className:"bg-green-500/20 text-green-400",children:"Installed"}),ye===se.PARTIAL&&e.jsx(q,{variant:"secondary",className:"bg-yellow-500/20 text-yellow-400",children:"Partial"}),ye===se.NOT_INSTALLED&&e.jsx(q,{variant:"secondary",className:"bg-red-500/20 text-red-400",children:"Not Installed"}),ye===se.CHECKING&&e.jsx(q,{variant:"secondary",className:"bg-blue-500/20 text-blue-400",children:"Checking..."})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:A?D:"Select a project root to begin"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ye!==se.INSTALLED&&e.jsxs(w,{type:"button",size:"sm",disabled:!A||Je||Z,onClick:()=>nr(),className:"gap-2",children:[Je?e.jsx(ge,{className:"h-4 w-4 animate-spin"}):e.jsx(be,{className:"h-4 w-4"}),Je?"Installing...":"Setup BMAD"]}),e.jsxs(w,{type:"button",variant:"outline",size:"sm",disabled:!A||Je,onClick:()=>{nt(),ct()},className:"gap-2",children:[e.jsx(ge,{className:$("h-4 w-4",ye===se.CHECKING&&"animate-spin")}),"Sync"]})]})]}),A&&ye!==se.NOT_CHECKED&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[{key:"core",label:"Core",icon:"ðŸŽ¯"},{key:"bmm",label:"BMM Module",icon:"ðŸ“‹"},{key:"_config",label:"Config",icon:"âš™ï¸"}].map(t=>e.jsxs("div",{className:$("rounded-lg border p-2 text-center transition-colors",qe[t.key]?"border-green-500/30 bg-green-500/5":"border-border/30 bg-background/30"),children:[e.jsx("div",{className:"text-lg",children:t.icon}),e.jsx("div",{className:"text-[10px] font-medium",children:t.label}),e.jsx("div",{className:$("text-[9px]",qe[t.key]?"text-green-400":"text-muted-foreground"),children:qe[t.key]?"âœ“ Found":"âœ— Missing"})]},t.key))}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-medium mb-2",children:"BMAD v6 Workflow Phases"}),e.jsx("div",{className:"grid grid-cols-4 gap-1",children:qs.map((t,i)=>{const g=ms[t.id],p=ds===t.id;return e.jsxs("div",{className:$("rounded-lg border p-2 cursor-pointer transition-all","hover:border-primary/50",p&&"border-primary bg-primary/10",(g==null?void 0:g.completed)&&"border-green-500/50 bg-green-500/5",!p&&!(g!=null&&g.completed)&&"border-border/30 bg-background/30"),onClick:()=>Ke(t.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:t.icon}),(g==null?void 0:g.completed)&&e.jsx(ss,{className:"h-3 w-3 text-green-500"})]}),e.jsx("div",{className:"text-[10px] font-medium mt-1",children:t.name}),e.jsx("div",{className:"text-[9px] text-muted-foreground",children:t.required?"Required":"Optional"})]},t.id)})})]}),(()=>{const t=qs.find(p=>p.id===ds);if(!t)return null;const i=ft.find(p=>p.id===t.agent),g=mt.filter(p=>p.phase===ds||p.phase==="all");return e.jsxs("div",{className:"rounded-lg border border-primary/30 bg-primary/5 p-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[t.icon," ",t.name,t.required&&e.jsx(q,{variant:"secondary",className:"text-[9px]",children:"Required"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.description})]}),i&&e.jsx(q,{variant:"outline",className:"text-[10px]",children:i.label})]}),e.jsx("div",{className:"text-[10px] font-medium mt-3 mb-1",children:"Available Workflows:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:g.map(p=>e.jsx(w,{type:"button",size:"sm",variant:us===p.id?"default":"outline",className:"h-6 text-[10px] px-2",onClick:()=>{Us(p.id);const I=`@${p.agent} *${p.id}`;He(`wf-${p.id}`,I)},children:p.name},p.id))}),us&&(()=>{const p=mt.find(T=>T.id===us);if(!p)return null;ft.find(T=>T.id===p.agent);const I=`@${p.agent} *${p.id}`;return e.jsxs("div",{className:"mt-3 p-2 rounded border border-border/30 bg-black/50",children:[e.jsx("div",{className:"flex items-center justify-between gap-2 mb-1",onClick:()=>He(`wf-${p.id}`,I),children:e.jsxs("div",{className:"text-[10px] text-muted-foreground",children:[p.description," ",e.jsx(Ze,{className:"h-3 w-3"}),Y===`wf-${p.id}`?"Copied!":"Copy"]})}),e.jsx("code",{className:"text-xs text-green-400 font-mono",children:I})]})})()]})})()]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"BMAD CLI Output"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ce,{value:String(s.bmadMode||"npx"),onValueChange:t=>a({...s,bmadMode:t}),children:[e.jsx(oe,{className:"w-[100px] h-8 bg-background/50 text-xs",children:e.jsx(le,{placeholder:"Mode"})}),e.jsxs(ie,{children:[e.jsx(B,{value:"npx",children:"npx"}),e.jsx(B,{value:"bmad",children:"bmad"})]})]}),e.jsx(w,{type:"button",variant:"outline",size:"sm",disabled:!A||Z,onClick:()=>tr("status"),children:"Status"}),e.jsx(w,{type:"button",variant:"destructive",size:"sm",disabled:!Z,onClick:()=>rr(),children:"Stop"})]})]}),e.jsx("div",{className:"rounded-lg border border-border/50 bg-black/90 p-3",children:e.jsx(he,{className:"h-[100px]",children:e.jsx("pre",{className:"text-xs text-gray-100 whitespace-pre-wrap break-words",children:ke.length?ke.map(t=>String((t==null?void 0:t.message)||"")).join(`
`):"No BMAD logs yet"})})}),Z&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(L,{value:Se,onChange:t=>ts(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),wt())},placeholder:"Type response and press Enter",className:"bg-background/50 text-xs",disabled:!Z}),e.jsx(w,{type:"button",size:"sm",disabled:!Z||!String(Se||"").trim(),onClick:()=>wt(),children:"Send"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(Re,{value:Be,onValueChange:ns,children:[e.jsxs(Ee,{className:"grid w-full grid-cols-3",children:[e.jsx(J,{value:"wizard",children:"Wizard"}),e.jsx(J,{value:"advanced",children:"Advanced"}),e.jsx(J,{value:"preview",children:"Preview"})]}),e.jsx(H,{value:"wizard",className:"mt-4",children:e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Step 1: Phase"}),e.jsxs(ce,{value:String(K),onValueChange:t=>Ie(t),children:[e.jsx(oe,{className:"w-full bg-background/50",children:e.jsx(le,{placeholder:"Phase"})}),e.jsx(ie,{children:qs.map(t=>e.jsx(B,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Step 2: Workflow"}),e.jsxs(ce,{value:String(Qe),onValueChange:t=>fe(t),children:[e.jsx(oe,{className:"w-full bg-background/50",children:e.jsx(le,{placeholder:"Workflow"})}),e.jsx(ie,{children:Ye.map(t=>e.jsx(B,{value:t.value,children:t.label},t.value))})]})]})]}),Qe==="research"&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("div",{className:"grid sm:grid-cols-3 gap-3",children:e.jsxs("div",{children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Research type"}),e.jsxs(ce,{value:String(je),onValueChange:t=>cs(t),children:[e.jsx(oe,{className:"w-full bg-background/50",children:e.jsx(le,{placeholder:"Type"})}),e.jsxs(ie,{children:[e.jsx(B,{value:"market",children:"market"}),e.jsx(B,{value:"technical",children:"technical"}),e.jsx(B,{value:"deep_prompt",children:"deep_prompt"})]})]})]})}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Input 1"}),e.jsx(L,{value:re[0]||"",onChange:t=>{const i=[...re];i[0]=t.target.value,$e(i)},placeholder:"product-brief.md",className:"bg-background/50"})]}),e.jsxs("div",{children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Input 2"}),e.jsx(L,{value:re[1]||"",onChange:t=>{const i=[...re];i[1]=t.target.value,$e(i)},placeholder:"competitor-list.md",className:"bg-background/50"})]}),e.jsxs("div",{children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Input 3"}),e.jsx(L,{value:re[2]||"",onChange:t=>{const i=[...re];i[2]=t.target.value,$e(i)},placeholder:"requirements.md",className:"bg-background/50"})]})]})]}),Qe==="product-brief"&&e.jsx("div",{className:"grid sm:grid-cols-2 gap-3",children:e.jsxs("div",{children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Optional input document"}),e.jsx(L,{value:me,onChange:t=>ks(t.target.value),placeholder:"market-research.md",className:"bg-background/50"})]})}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Context file (for `--data` / preview)"}),e.jsx(L,{value:ne,onChange:t=>V(t.target.value),placeholder:"_bmad-output/prd.md",className:"bg-background/50"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs(w,{type:"button",size:"sm",variant:"outline",className:"gap-2",disabled:!As,onClick:()=>He("workflow-wizard",As),children:[e.jsx(Ze,{className:"h-4 w-4"}),Y==="workflow-wizard"?"Copied":"Copy"]}),e.jsx(w,{type:"button",size:"sm",disabled:!A||!Ws.length||ue,onClick:()=>ir(),children:ue?"Running":"Run"}),e.jsx(w,{type:"button",size:"sm",variant:"outline",disabled:!ne,onClick:()=>ns("preview"),children:"Preview"})]})]}),e.jsx("div",{className:"rounded-lg border border-border/50 bg-black/90 p-3",children:e.jsx("pre",{className:"text-xs text-gray-100 whitespace-pre-wrap break-words",children:As||"Select a workflow"})})]})}),e.jsx(H,{value:"advanced",className:"mt-4",children:e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Workflow"}),e.jsxs(ce,{value:String(ys),onValueChange:t=>Rs(t),children:[e.jsx(oe,{className:"w-full bg-background/50",children:e.jsx(le,{placeholder:"Workflow"})}),e.jsxs(ie,{children:[e.jsx(B,{value:"status",children:"status"}),e.jsx(B,{value:"prd",children:"prd"}),e.jsx(B,{value:"brainstorm-project",children:"brainstorm-project"}),e.jsx(B,{value:"research",children:"research"}),e.jsx(B,{value:"product-brief",children:"product-brief"}),e.jsx(B,{value:"brainstorming",children:"brainstorming"})]})]})]}),e.jsx("div",{className:"flex items-end justify-between gap-3",children:e.jsxs("div",{className:"grid gap-1",children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Include --data"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ks,{checked:rs,onCheckedChange:t=>as(t),disabled:!Xe}),e.jsx("div",{className:"text-xs text-muted-foreground truncate max-w-[220px]",children:Xe||"No PRD path"})]})]})})]}),e.jsx("div",{className:"rounded-lg border border-border/50 bg-black/90 p-3",children:e.jsx("pre",{className:"text-xs text-gray-100 whitespace-pre-wrap break-words",children:ot})})]})}),e.jsx(H,{value:"preview",className:"mt-4",children:e.jsx("div",{className:"grid gap-3",children:e.jsxs(Re,{defaultValue:"data",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-2",children:[e.jsx(J,{value:"data",children:"Data File"}),e.jsx(J,{value:"output",children:"Run Output"})]}),e.jsx(H,{value:"data",className:"mt-4",children:e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Preview file (relative to project root)"}),e.jsx(L,{value:ne,onChange:t=>V(t.target.value),placeholder:"_bmad-output/prd.md",className:"bg-background/50"})]}),e.jsxs(w,{type:"button",size:"sm",variant:"outline",className:"gap-2",disabled:!A||!ne||Oe,onClick:()=>lt(),children:[e.jsx(ge,{className:"h-4 w-4"}),Oe?"Loading":"Refresh"]})]}),Es&&e.jsx("div",{className:"text-xs text-red-400",children:Es}),e.jsx("div",{className:"rounded-lg border border-border/50 bg-black/90 p-3",children:e.jsx(he,{className:"h-[180px]",children:e.jsx("pre",{className:"text-xs text-gray-100 whitespace-pre-wrap break-words",children:Ms||(A?"No preview loaded":"Select a project root first")})})})]})}),e.jsx(H,{value:"output",className:"mt-4",children:e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:ue?"Workflow running":ve.length?"Last workflow run output":"No workflow run yet"}),e.jsx(w,{type:"button",size:"sm",variant:"outline",disabled:!ve.length,onClick:()=>Fe([]),children:"Clear"})]}),e.jsx("div",{className:"rounded-lg border border-border/50 bg-black/90 p-3",children:e.jsx(he,{className:"h-[180px]",children:e.jsx("pre",{className:"text-xs text-gray-100 whitespace-pre-wrap break-words",children:ve.length?ve.map(t=>String((t==null?void 0:t.message)||"")).join(`
`):""})})})]})})]})})})]})}),e.jsx("div",{className:"rounded-xl border border-border/50 bg-secondary/10 p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:$("w-2.5 h-2.5 rounded-full",x?"bg-green-500 animate-pulse":h?"bg-amber-500":"bg-destructive")}),e.jsx("div",{className:"text-sm font-medium",children:x?"Connected (Live)":h?"Server running, reconnect needed":"Server stopped"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>N(),className:"gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Sync"]}),e.jsx(w,{variant:h?"destructive":"default",size:"sm",onClick:f,disabled:y,className:"gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"h-4 w-4"}),"Stop"]}):e.jsxs(e.Fragment,{children:[e.jsx(er,{className:"h-4 w-4"}),"Start"]})})]})]})}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Select your IDE"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Kr.map(t=>{const i=Array.isArray(s.ides)?s.ides.includes(t.id):!1;return e.jsx(w,{type:"button",variant:i?"default":"outline",size:"sm",onClick:()=>mr(t.id),children:t.label},t.id)})})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Project root"}),e.jsx(L,{value:s.projectRoot,onChange:t=>a({...s,projectRoot:t.target.value}),placeholder:"c:/path/to/next-gen/ui",className:"bg-background/50"}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx(w,{type:"button",size:"sm",variant:"outline",onClick:()=>sr(),children:"Browse"}),e.jsx(w,{type:"button",size:"sm",variant:"outline",disabled:!A||!((yt=window.electronAPI)!=null&&yt.openFolder),onClick:()=>window.electronAPI.openFolder(D),children:"Open"})]}),e.jsx("div",{className:"text-[11px] text-muted-foreground mt-2",children:"Used for BMAD CLI runs and file generation"})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Remote URL"}),e.jsx("div",{className:"text-[11px] text-muted-foreground mt-1",children:"Generates URL-based config and skips internal start/stop"})]}),e.jsx(Ks,{checked:!!y,onCheckedChange:t=>U(t)})]}),e.jsxs("div",{className:"grid gap-1.5 mt-3",children:[e.jsx(_,{className:"text-xs",children:"Server base URL"}),e.jsx(L,{value:String(R||""),onChange:t=>te(t.target.value),placeholder:"http://localhost:3847",className:"bg-background/50",disabled:!y})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"MCP Server config"}),e.jsxs(w,{type:"button",size:"sm",variant:"outline",className:"gap-2",onClick:()=>He("mcp-config",xs),children:[e.jsx(Ze,{className:"h-4 w-4"}),Y==="mcp-config"?"Copied":"Copy"]})]}),e.jsx("div",{className:"rounded-lg border border-border/50 bg-black/90 p-3",children:e.jsx(he,{className:"h-[160px]",children:e.jsx("pre",{className:"text-xs text-gray-100 whitespace-pre-wrap break-words",children:xs})})})]})]})})}),e.jsx(H,{value:"team",className:"flex-1 min-h-0",children:e.jsx(he,{className:"h-full",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"User context"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Your name"}),e.jsx(L,{value:s.ownerName||"",onChange:t=>a({...s,ownerName:t.target.value}),className:"bg-background/50"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Language"}),e.jsxs(ce,{value:String(s.language||"English"),onValueChange:t=>a({...s,language:t}),children:[e.jsx(oe,{className:"bg-background/50",children:e.jsx(le,{placeholder:"Select"})}),e.jsxs(ie,{children:[e.jsx(B,{value:"English",children:"English"}),e.jsx(B,{value:"Khmer",children:"Khmer"})]})]})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Team name"}),e.jsx(L,{value:s.teamName||"",onChange:t=>a({...s,teamName:t.target.value}),className:"bg-background/50"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Team members"}),e.jsx(L,{value:s.teamMembers||"",onChange:t=>a({...s,teamMembers:t.target.value}),placeholder:"Alice, Bob, Carol",className:"bg-background/50"})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Team context"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Team size"}),e.jsx(L,{inputMode:"numeric",value:s.teamSize,onChange:t=>a({...s,teamSize:t.target.value}),className:"bg-background/50"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Sprint length (days)"}),e.jsxs(ce,{value:String(s.sprintLength||"14"),onValueChange:t=>a({...s,sprintLength:t}),children:[e.jsx(oe,{className:"bg-background/50",children:e.jsx(le,{placeholder:"Select"})}),e.jsxs(ie,{children:[e.jsx(B,{value:"7",children:"7"}),e.jsx(B,{value:"14",children:"14"}),e.jsx(B,{value:"21",children:"21"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mt-4",children:[e.jsxs(_,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm",children:"Auto-sync"}),e.jsx("span",{className:"font-normal text-xs text-muted-foreground",children:"Pull state every 30s (optional)"})]}),e.jsx(Ks,{checked:!!s.autoSync,onCheckedChange:t=>a({...s,autoSync:t})})]})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Recommendation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"bg-primary/15 text-primary",children:"Recommended"}),e.jsx("div",{className:"text-sm",children:S})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:"You can override this based on your workflow"})]})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-3",children:"Select your agent"}),e.jsx("div",{className:"grid gap-2",children:ur.map(t=>e.jsx("button",{type:"button",className:$("p-3 rounded-xl border text-left transition-all","hover:bg-accent/50",t.isSelected?"border-primary bg-primary/5 ring-2 ring-primary/30":"border-border/50 bg-background/30"),onClick:()=>{a({...s,agent:t.id}),navigator.clipboard.writeText(t.id).catch(()=>{})},children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{children:t.label}),t.isRecommended&&e.jsx(q,{className:"bg-primary/15 text-primary",children:"âœ¨"})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:t.description})]}),t.isSelected&&e.jsx(ss,{className:"h-5 w-5 text-primary"})]})},t.id))}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mt-4",children:[e.jsxs(w,{type:"button",variant:"outline",size:"sm",className:"gap-2",onClick:()=>ae(t=>!t),children:[e.jsx(Nr,{className:"h-4 w-4"}),"See comparison"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(w,{type:"button",variant:"outline",size:"sm",className:"gap-2",onClick:()=>He("slash",tt),children:[e.jsx(Ze,{className:"h-4 w-4"}),Y==="slash"?"Copied":"Copy command"]}),e.jsxs(w,{type:"button",size:"sm",className:"gap-2",onClick:()=>{a({...s,agent:k}),z("project")},children:[e.jsx(qt,{className:"h-4 w-4"}),"Continue"]})]}),de&&e.jsxs("div",{className:"mt-4 rounded-xl border border-border/50 bg-secondary/10 p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Comparison"}),e.jsx("div",{className:"grid gap-2",children:Et.map(t=>e.jsxs("div",{className:"rounded-lg border border-border/50 bg-background/40 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:t.label}),e.jsx(q,{variant:"secondary",className:"text-[10px]",children:t.id})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:t.description})]},t.id))})]})]})]})})}),e.jsx(H,{value:"project",className:"flex-1 min-h-0",children:e.jsx(he,{className:"h-full",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"PRD"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Project name"}),e.jsx(L,{value:s.projectName||"",onChange:t=>a({...s,projectName:t.target.value}),className:"bg-background/50"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"PRD path (relative)"}),e.jsx(L,{value:pe,onChange:t=>a({...s,prdPath:t.target.value}),className:"bg-background/50"})]})]}),e.jsxs("div",{className:"grid gap-3 mt-4",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Overview"}),e.jsx("textarea",{value:s.projectSummary||"",onChange:t=>a({...s,projectSummary:t.target.value}),className:"min-h-[72px] w-full rounded-md border border-border bg-background/50 px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Goals"}),e.jsx("textarea",{value:s.projectGoals||"",onChange:t=>a({...s,projectGoals:t.target.value}),className:"min-h-[72px] w-full rounded-md border border-border bg-background/50 px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Non-goals"}),e.jsx("textarea",{value:s.projectNonGoals||"",onChange:t=>a({...s,projectNonGoals:t.target.value}),className:"min-h-[72px] w-full rounded-md border border-border bg-background/50 px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Target users"}),e.jsx("textarea",{value:s.projectUsers||"",onChange:t=>a({...s,projectUsers:t.target.value}),className:"min-h-[72px] w-full rounded-md border border-border bg-background/50 px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Success metrics"}),e.jsx("textarea",{value:s.projectSuccessMetrics||"",onChange:t=>a({...s,projectSuccessMetrics:t.target.value}),className:"min-h-[72px] w-full rounded-md border border-border bg-background/50 px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(_,{className:"text-xs",children:"Constraints"}),e.jsx("textarea",{value:s.projectConstraints||"",onChange:t=>a({...s,projectConstraints:t.target.value}),className:"min-h-[72px] w-full rounded-md border border-border bg-background/50 px-3 py-2 text-sm"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-4",children:[e.jsx(w,{type:"button",disabled:!A||Me,onClick:()=>dr(),className:"gap-2",children:"Generate PRD"}),e.jsxs(w,{type:"button",variant:"outline",disabled:!A,onClick:()=>He("prd",it()),className:"gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),Y==="prd"?"Copied":"Copy"]}),e.jsx(w,{type:"button",variant:"outline",disabled:!A||!((kt=window.electronAPI)!=null&&kt.openFolder),onClick:()=>window.electronAPI.openFolder(D),children:"Open project"}),e.jsx(w,{type:"button",variant:"outline",disabled:!A,onClick:()=>z("actions"),children:"Continue"})]}),F&&e.jsx("div",{className:$("mt-3 text-xs rounded-md border p-2",F.ok?"border-green-500/30 bg-green-500/10 text-green-200":"border-destructive/30 bg-destructive/10 text-destructive"),children:F.ok?`PRD written: ${F.path}`:F.message})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium flex items-center gap-2",children:"ðŸ“‹ Context Management"}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"BMAD workflow documents, agent rules, and project context files"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{type:"button",size:"sm",variant:"outline",className:"gap-2",disabled:!A||Bs,onClick:()=>at(),children:[e.jsx(ge,{className:$("h-4 w-4",Bs&&"animate-spin")}),"Scan"]}),e.jsxs(w,{type:"button",size:"sm",variant:"outline",className:"gap-2",disabled:!A||ls,onClick:()=>{Te.forEach(t=>{t!=null&&t.path&&Gs({docId:t.id,relativePath:t.path,force:!0})})},children:[e.jsx(ge,{className:"h-4 w-4"}),"Reload All"]})]})]}),e.jsxs(Re,{value:Ys,onValueChange:Qs,children:[e.jsx(Ee,{className:"grid w-full grid-cols-4 mb-4",children:Ps.map(t=>e.jsxs(J,{value:t.id,className:"text-xs gap-1",children:[e.jsx("span",{children:t.icon}),e.jsx("span",{className:"hidden sm:inline",children:t.label})]},t.id))}),Ps.map(t=>e.jsx(H,{value:t.id,className:"mt-0",children:e.jsxs("div",{className:"rounded-lg border border-border/30 bg-black/20 p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:t.description}),e.jsx("div",{className:"grid gap-2",children:t.items.map(i=>{const g=Zs[i.id],p=g==null?void 0:g.exists,I=Te.some(dt=>dt.path===i.path),T=!!i.ide,ee=Array.isArray(s.ides)?s.ides:[],M=!T||ee.includes(i.ide);return e.jsxs("div",{className:$("flex items-center justify-between gap-3 rounded-md border p-2 transition-colors",p?"border-green-500/30 bg-green-500/5":"border-border/30 bg-background/30",!M&&"opacity-50"),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:$("w-2 h-2 rounded-full shrink-0",p?"bg-green-500":"bg-muted-foreground/30")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-xs font-medium truncate flex items-center gap-2",children:[i.label,i.required&&e.jsx(q,{variant:"secondary",className:"text-[9px] px-1",children:"Required"}),T&&e.jsx(q,{variant:"outline",className:"text-[9px] px-1",children:i.ide})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:i.path})]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[p&&!I&&e.jsxs(w,{type:"button",size:"sm",variant:"ghost",className:"h-7 text-xs",disabled:!A,onClick:()=>or(i),children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"Add"]}),I&&e.jsx(q,{variant:"secondary",className:"text-[9px]",children:"Added"}),!p&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Not found"})]})]},i.id)})})]})},t.id))]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border/30",children:[e.jsx("div",{className:"text-xs font-medium mb-2",children:"Add Custom Context"}),e.jsxs("div",{className:"grid sm:grid-cols-4 gap-2",children:[e.jsx(L,{value:_s,onChange:t=>Is(t.target.value),placeholder:"Label",className:"bg-background/50 text-xs",disabled:!A}),e.jsx(L,{value:is,onChange:t=>$s(t.target.value),placeholder:"Relative path (e.g. docs/spec.md)",className:"bg-background/50 text-xs sm:col-span-2",disabled:!A}),e.jsxs(w,{type:"button",size:"sm",className:"gap-1",disabled:!A||!String(is||"").trim(),onClick:()=>cr(),children:[e.jsx(be,{className:"h-3 w-3"}),"Add"]})]})]}),Te.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-border/30",children:[e.jsxs("div",{className:"text-xs font-medium mb-2",children:["Active Context Files (",Te.length,")"]}),e.jsxs(Re,{value:Ge,onValueChange:W,children:[e.jsx(Ee,{className:"w-full overflow-x-auto justify-start mb-3",children:Te.map(t=>{const i=Ps.find(g=>g.id===t.category);return e.jsxs(J,{value:t.id,className:"shrink-0 text-xs gap-1",children:[e.jsx("span",{children:(i==null?void 0:i.icon)||"ðŸ“„"}),t.label]},t.id)})}),Te.map(t=>{const i=Object.hasOwn(we,t.id)&&typeof we[t.id]=="string"?we[t.id]:"",g=Ne&&Ne.docId===t.id?Ne:null;return e.jsx(H,{value:t.id,className:"mt-0",children:e.jsxs(Wt,{className:"border-border/50 bg-background/40",children:[e.jsxs(jr,{className:"pb-2 pt-3 px-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(vr,{className:"text-sm",children:t.label}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate mt-0.5",children:t.path})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",disabled:!A||ls,onClick:()=>Gs({docId:t.id,relativePath:t.path,force:!0}),children:e.jsx(ge,{className:"h-3.5 w-3.5"})}),e.jsx(w,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",disabled:!A||ls,onClick:()=>ar({docId:t.id,relativePath:t.path}),children:e.jsx(ss,{className:"h-3.5 w-3.5"})}),e.jsx(w,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",disabled:!A,onClick:()=>He(`ctx-${t.id}`,i),children:e.jsx(Ze,{className:"h-3.5 w-3.5"})}),t.id!=="prd"&&e.jsx(w,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 text-destructive",disabled:!A||ls,onClick:()=>lr(t.id),children:e.jsx(Xs,{className:"h-3.5 w-3.5"})})]})]}),g&&e.jsx("div",{className:$("mt-2 text-[10px] rounded-md border px-2 py-1",g.ok?"border-green-500/30 bg-green-500/10 text-green-200":"border-destructive/30 bg-destructive/10 text-destructive"),children:g.message})]}),e.jsx(Vt,{className:"px-3 pb-3",children:e.jsxs(Re,{defaultValue:"preview",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-2 h-8",children:[e.jsx(J,{value:"preview",className:"text-xs",children:"Preview"}),e.jsx(J,{value:"edit",className:"text-xs",children:"Edit"})]}),e.jsx(H,{value:"preview",className:"mt-2",children:e.jsx("div",{className:"rounded-md border border-border/50 bg-black/50 p-3 h-[240px] overflow-auto",children:e.jsx(Xr,{value:i})})}),e.jsx(H,{value:"edit",className:"mt-2",children:e.jsx("textarea",{className:"h-[240px] w-full rounded-md border border-border bg-background/50 px-3 py-2 text-xs font-mono",value:i,onChange:p=>rt(t.id,p.target.value)})})]})})]})},t.id)})]})]})]})]})})}),e.jsx(H,{value:"actions",className:"flex-1 min-h-0",children:e.jsx(he,{className:"h-full",children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Board"}),e.jsx("div",{className:"text-sm font-medium truncate",children:(n==null?void 0:n.name)||"No board selected"})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Stories"}),e.jsx("div",{className:"text-sm font-medium",children:(d==null?void 0:d.total)||0})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Agent"}),e.jsx("div",{className:"text-sm font-medium",children:k})]})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-3",children:"Quick actions"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(w,{type:"button",variant:"outline",className:"gap-2",disabled:!Vs,onClick:()=>l(),children:[e.jsx(be,{className:"h-4 w-4"}),"Create story"]}),e.jsxs(w,{type:"button",variant:"outline",className:"gap-2",disabled:!Vs||!hs,onClick:()=>u(hs.listId,hs.card),children:[e.jsx(Kt,{className:"h-4 w-4"}),"Open next ready"]}),e.jsxs(w,{type:"button",className:"gap-2",disabled:!Vs||!hs||!Nt,onClick:()=>b(hs,Nt),children:[e.jsx(Ht,{className:"h-4 w-4"}),"Start next story"]}),e.jsxs(w,{type:"button",variant:"outline",className:"gap-2",onClick:()=>N(),children:[e.jsx(ge,{className:"h-4 w-4"}),"Sync MCP"]})]}),!hs&&Vs&&e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:"No stories in Ready for Dev"})]}),e.jsxs("div",{className:"rounded-xl border border-border/50 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Test agent"}),e.jsxs(w,{type:"button",size:"sm",variant:"outline",className:"gap-2",onClick:()=>N(),children:[e.jsx(Ut,{className:"h-4 w-4"}),"Run"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Verifies MCP connectivity by syncing state and reflecting updates in the board"})]})]})})})]}),e.jsxs(Ns,{children:[e.jsx(w,{variant:"outline",onClick:()=>m(!1),children:"Close"}),e.jsx(w,{onClick:()=>{m(!1)},children:"Done"})]})]})})},oa=({onReconnect:r,onOpenSettings:m,serverRunning:s})=>e.jsxs("div",{className:"rounded-xl border border-border/50 bg-card/50 backdrop-blur-sm p-8 h-full flex flex-col items-center justify-center gap-6 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted/50",children:e.jsx(vt,{className:"h-12 w-12 text-muted-foreground"})}),e.jsxs("div",{className:"max-w-md space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Connection Lost"}),e.jsx("p",{className:"text-muted-foreground",children:s?"The Kanban server is running but cannot be reached. It may be blocked or busy.":"The Kanban server is currently stopped. Please start the server to access the board."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(w,{variant:"outline",onClick:m,children:[e.jsx(jt,{className:"h-4 w-4 mr-2"}),"Settings"]}),e.jsxs(w,{onClick:r,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Try Reconnecting"]})]})]});function xa(){var zs,ds,Ke,ms,Fs,us,Us,Je;const{state:r,loading:m,error:s,connected:a,activeBoardId:n,lockedCards:d,connect:l,disconnect:u,loadLocalState:b,setActiveBoard:x,createBoard:h,deleteBoard:f,deleteList:C,addList:N,renameList:y,addCard:R,updateCard:U,deleteCard:te,moveCard:G,moveList:z,acquireLock:de,releaseLock:ae,isCardLocked:Y,getCardLock:P,getActiveBoard:Q,getEpics:ke,getStats:O,syncNow:Z,checkServerStatus:Ce,serverRunning:Se,clearError:ts}=Hs(),[Me,_e]=c.useState(!1),[F,xe]=c.useState(null),[ys,Rs]=c.useState(!1),[rs,as]=c.useState(!1),[Be,ns]=c.useState(!1),[K,Ie]=c.useState(null),[Le,fe]=c.useState(null),[je,cs]=c.useState(!1),[re,$e]=c.useState(""),me=c.useRef(null),[ks,ne]=c.useState(()=>{try{return localStorage.getItem(Dt)==="stats"?"stats":"mcp"}catch{return"mcp"}}),[V,Oe]=c.useState(()=>{const o={ides:["cursor"],projectRoot:"",bmadMode:"npx",bmadVerbose:!1,ownerName:"",language:"English",teamName:"",teamMembers:"",teamSize:"5",sprintLength:"14",autoSync:!1,agent:"",projectName:"",prdPath:"_bmad-output/prd.md",projectSummary:"",projectGoals:"",projectNonGoals:"",projectUsers:"",projectSuccessMetrics:"",projectConstraints:"",contextDocs:[]};let j=null;try{j=Lt(localStorage.getItem(Pt)||"")}catch{j=null}return!j||typeof j!="object"?o:{...o,...j,ides:Array.isArray(j.ides)?j.ides:o.ides}});c.useEffect(()=>{try{localStorage.setItem(Pt,JSON.stringify(V))}catch{}},[V]);const[ze,Es]=c.useState(()=>{let o=null;try{o=Lt(localStorage.getItem(Tt)||"")}catch{o=null}return Array.isArray(o)?o.map(j=>String(j||"").trim()).filter(Boolean).slice(0,Rt):[]});c.useEffect(()=>{const o=String(V.projectRoot||"").trim();o&&Es(j=>{const v=[o,...j.filter(S=>S!==o)].slice(0,Rt);try{localStorage.setItem(Tt,JSON.stringify(v))}catch{}return v})},[V.projectRoot]);const Cs=c.useCallback(o=>{const j=String(o||"").replace(/[\\/]+$/,""),v=j.split(/[\\/]+/).filter(Boolean);return v[v.length-1]||j},[]),Ms=c.useCallback(async()=>{var o;if((o=window.electronAPI)!=null&&o.selectFolder){const j=await window.electronAPI.selectFolder({title:"Select project root",defaultPath:V.projectRoot||void 0});j&&Oe(v=>({...v,projectRoot:j}));return}$e(String(V.projectRoot||"")),cs(!0)},[V.projectRoot]),Ss=c.useMemo(()=>{const o=String(V.projectRoot||"").trim();return o&&!ze.includes(o)?[o,...ze]:ze},[V.projectRoot,ze]);c.useEffect(()=>{try{localStorage.setItem(Dt,ks)}catch{}},[ks]),c.useEffect(()=>{if(!V.autoSync||!a)return;const o=window.setInterval(()=>Z(),3e4);return()=>window.clearInterval(o)},[V.autoSync,a,Z]);const[ue,Ae]=c.useState({open:!1,title:"",description:"",confirmText:"Delete"}),[ve,Fe]=c.useState(!1),Ue=c.useRef(null),Ge=c.useCallback(({title:o,description:j,confirmText:v,onConfirm:S})=>{Ue.current=S,Fe(!1),Ae({open:!0,title:o,description:j,confirmText:v||"Delete"})},[]);c.useEffect(()=>{Ce(),l();const o=setTimeout(()=>{const{connected:j,loading:v}=Hs.getState();!j&&v&&b()},3e3);return()=>{clearTimeout(o),u()}},[Ce,l,u,b]);const W=Q(),we=ke(),os=O(),ls=c.useMemo(()=>{var S;if(!((S=W==null?void 0:W.lists)!=null&&S.length))return{};const o=k=>{const E=Date.parse(String(k||""));return Number.isFinite(E)?E:0},j=[];for(const k of W.lists)for(const E of k.cards||[])j.push({cardId:E.id,createdAtMs:o(E.createdAt)});j.sort((k,E)=>k.createdAtMs!==E.createdAtMs?k.createdAtMs-E.createdAtMs:String(k.cardId).localeCompare(String(E.cardId)));const v={};for(let k=0;k<j.length;k+=1){const E=j[k];v[E.cardId]=`${W.name}:${k+1}`}return v},[W]),Pe=c.useCallback(async o=>{xe({boardId:n,listId:o,card:null}),_e(!0)},[n]),Ne=c.useCallback(async(o,j)=>{await de(j.id),xe({boardId:n,listId:o,card:j}),_e(!0)},[de,n]),We=async o=>{var j;!o&&((j=F==null?void 0:F.card)!=null&&j.id)&&await ae(F.card.id),_e(o),o||xe(null)},Ve=async o=>{const{listId:j,card:v}=F;v!=null&&v.id?(await U(n,j,v.id,o),await ae(v.id)):await R(n,j,o),_e(!1),xe(null)},Ys=async()=>{const{listId:o,card:j}=F;j!=null&&j.id&&Ge({title:"Delete story?",description:"This action cannot be undone.",confirmText:"Delete",onConfirm:async()=>{await te(n,o,j.id)&&(_e(!1),xe(null))}})},Qs=async o=>n?N(n,o):!1,Zs=async(o,j)=>n?y(n,o,j):!1,et=async o=>{var S,k;const j=Q(),v=(S=j==null?void 0:j.lists)==null?void 0:S.find(E=>E.id===o);Ge({title:"Delete list?",description:(k=v==null?void 0:v.cards)!=null&&k.length?`This will delete the list and ${v.cards.length} stories inside it.`:"This action cannot be undone.",confirmText:"Delete",onConfirm:async()=>{await C(n,o)}})},Bs=c.useCallback(()=>{var v,S,k,E;if(!n)return;const o=Q(),j=((S=(v=o==null?void 0:o.lists)==null?void 0:v.find(xs=>xs.statusId==="backlog"))==null?void 0:S.id)||((E=(k=o==null?void 0:o.lists)==null?void 0:k[0])==null?void 0:E.id)||null;j&&Pe(j)},[n,Q,Pe]),Ls=c.useCallback((o,j)=>{!n||!o||!j||Ne(o,j)},[n,Ne]),_s=c.useCallback(async(o,j)=>{var k;if(!n)return;const v=o==null?void 0:o.listId,S=(k=o==null?void 0:o.card)==null?void 0:k.id;!v||!S||!j||(await G(n,S,v,j,0),Ne(j,o.card))},[n,G,Ne]),Is=o=>{try{return JSON.parse(o)}catch{return null}},is=(o,j,v,S)=>{if(Y(v)){o.preventDefault();return}const k={type:"scrum-card",listId:j,cardId:v,index:S};o.dataTransfer.setData("application/json",JSON.stringify(k)),o.dataTransfer.effectAllowed="move",Ie({type:"card",listId:j,cardId:v,index:S}),fe(null)},$s=()=>{Ie(null),fe(null)},Os=(o,j)=>{const v={type:"scrum-list",listId:j};o.dataTransfer.setData("application/json",JSON.stringify(v)),o.dataTransfer.effectAllowed="move",Ie({type:"list",listId:j}),fe(null)},st=()=>{Ie(null),fe(null)},ye=(o,j,v)=>{if((K==null?void 0:K.type)==="card"){o.preventDefault(),o.dataTransfer.dropEffect="move";return}if((K==null?void 0:K.type)!=="list")return;o.preventDefault(),o.dataTransfer.dropEffect="move";const S=o.currentTarget.getBoundingClientRect(),k=o.clientX>S.left+S.width/2,E=v+(k?1:0);fe({overListId:j,position:k?"after":"before",toIndex:E})},De=async(o,j,v)=>{if((K==null?void 0:K.type)!=="list")return;o.preventDefault(),o.stopPropagation();const S=Is(o.dataTransfer.getData("application/json"));if(!S||S.type!=="scrum-list")return;const k=S.listId;if(!k||!n)return;const E=o.currentTarget.getBoundingClientRect(),xs=o.clientX>E.left+E.width/2,tt=v+(xs?1:0);await z(n,k,tt),Ie(null),fe(null)},qe=async(o,j,v)=>{o.preventDefault(),o.stopPropagation();const S=Is(o.dataTransfer.getData("application/json"));if(!S||S.type!=="scrum-card")return;const k=S.listId,E=S.cardId;!k||!E||(await G(n,E,k,j,v),Ie(null))};return m&&!r?e.jsx("div",{className:"rounded-xl border border-border/50 bg-card/50 backdrop-blur-sm p-8 h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"h-8 w-8 mx-auto mb-3 text-primary animate-spin"}),e.jsx("p",{className:"text-muted-foreground",children:"Connecting to Kanban server..."})]})}):!a&&!m?e.jsxs(e.Fragment,{children:[e.jsx(oa,{onReconnect:()=>{Ce(),l()},onOpenSettings:()=>as(!0),serverRunning:Se}),e.jsx(Ot,{open:rs,onOpenChange:as})]}):e.jsxs("div",{className:"rounded-xl border border-border/50 bg-card/50 backdrop-blur-sm p-6 h-full min-h-0 flex flex-col gap-4",children:[s&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-destructive/10 border border-destructive/30 text-destructive",children:[e.jsx(Jt,{className:"h-5 w-5 shrink-0"}),e.jsx("span",{className:"flex-1 text-sm",children:s}),e.jsx(w,{variant:"ghost",size:"sm",onClick:ts,children:e.jsx(Gt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-primary/20 to-primary/10",children:e.jsx(zt,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Kanban Board"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"BMAD-Method Workflow"})]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx(w,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>as(!0),children:e.jsx(jt,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs(ce,{value:String(V.projectRoot||"").trim()||"",onValueChange:o=>{if(o==="__browse__"){Ms();return}Oe(j=>({...j,projectRoot:o}))},children:[e.jsx(oe,{className:"w-[220px] bg-background/50",children:e.jsx(le,{placeholder:"Select project"})}),e.jsxs(ie,{children:[e.jsx(B,{value:"__browse__",children:(zs=window.electronAPI)!=null&&zs.selectFolder?"Browse...":"Add project..."}),Ss.map(o=>e.jsx(B,{value:o,children:`${Cs(o)} â€” ${o}`},o))]})]}),e.jsxs(ce,{value:n||"",onValueChange:x,children:[e.jsx(oe,{className:"w-[200px] bg-background/50",children:e.jsx(le,{placeholder:"Select board"})}),e.jsx(ie,{children:(ds=r==null?void 0:r.boards)==null?void 0:ds.map(o=>e.jsx(B,{value:o.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[o.type==="bmad"&&e.jsx(Ds,{className:"h-3 w-3 text-primary"}),o.name]})},o.id))})]}),e.jsxs(w,{variant:"outline",onClick:()=>Rs(!0),className:"gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"New Board"]}),e.jsxs(w,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>ns(!0),children:[e.jsx(Ds,{className:"h-4 w-4"}),"Agent Assist"]}),W&&e.jsx(w,{variant:"destructive",size:"sm",onClick:()=>{Ge({title:"Delete board?",description:"This action cannot be undone.",confirmText:"Delete",onConfirm:async()=>{await f(W.id)}})},children:e.jsx(Xs,{className:"h-4 w-4"})})]})]}),W&&e.jsxs(Re,{value:ks,onValueChange:ne,className:"w-full",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-2",children:[e.jsx(J,{value:"mcp",children:"MCP Tool"}),e.jsx(J,{value:"stats",children:"Stats"})]}),e.jsx(H,{value:"mcp",className:"mt-3",children:e.jsx(sa,{activeBoard:W,projectRoot:V.projectRoot})}),e.jsx(H,{value:"stats",className:"mt-3",children:e.jsx(ea,{stats:os})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden min-h-0",children:e.jsxs("div",{className:"min-w-max flex gap-4 items-stretch pb-2 h-full",children:[(Ke=W==null?void 0:W.lists)==null?void 0:Ke.map((o,j)=>e.jsx(ra,{list:o,listDrop:Le,dragState:K,onDragStartList:v=>Os(v,o.id),onDragEndList:st,onDragOverList:v=>ye(v,o.id,j),onDropList:v=>{(K==null?void 0:K.type)==="card"?qe(v,o.id,o.cards.length):De(v,o.id,j)},onAddCard:()=>Pe(o.id),onEditCard:v=>Ne(o.id,v),onRename:v=>Zs(o.id,v),onDelete:()=>et(o.id),onDragStartCard:(v,S,k)=>is(v,o.id,S,k),onDragEndCard:$s,onDropToIndex:(v,S)=>qe(v,o.id,S),onDropToEnd:v=>qe(v,o.id,o.cards.length),isCardLocked:Y,getCardLock:P,storyKeyByCardId:ls},o.id)),e.jsx(aa,{onAdd:Qs})]})}),e.jsx(Zr,{open:Me,onOpenChange:We,initial:F==null?void 0:F.card,onSave:Ve,onDelete:Ys,epics:we,isLocked:(ms=F==null?void 0:F.card)!=null&&ms.id?Y(F.card.id):!1,lockInfo:(Fs=F==null?void 0:F.card)!=null&&Fs.id?P(F.card.id):null}),e.jsx(na,{open:ys,onOpenChange:Rs,onCreateBoard:h}),e.jsx(Ot,{open:rs,onOpenChange:as}),e.jsx(ca,{open:Be,onOpenChange:ns,setup:V,onChangeSetup:Oe,activeBoard:W,stats:os,onCreateStory:Bs,onOpenStory:Ls,onStartStory:_s}),e.jsx(fs,{open:je,onOpenChange:o=>cs(o),children:e.jsxs(js,{className:"sm:max-w-[520px] bg-background/95 backdrop-blur-lg",children:[e.jsxs(vs,{children:[e.jsx(ws,{children:"Project"}),e.jsx(Ts,{children:"Enter a project identifier to persist in your browser."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(_,{className:$("text-xs",(us=window.electronAPI)!=null&&us.selectFolder?"":"cursor-pointer"),onClick:()=>{var o;(o=window.electronAPI)!=null&&o.selectFolder||me.current&&me.current.click()},children:"Project root"}),!((Us=window.electronAPI)!=null&&Us.selectFolder)&&e.jsx(w,{type:"button",variant:"outline",size:"sm",onClick:()=>{me.current&&me.current.click()},children:"Browse"})]}),!((Je=window.electronAPI)!=null&&Je.selectFolder)&&e.jsx("input",{ref:me,type:"file",webkitdirectory:"",directory:"",multiple:!0,className:"hidden",onChange:o=>{const v=Array.from(o.target.files||[])[0],k=String((v==null?void 0:v.webkitRelativePath)||"").split("/").filter(Boolean)[0]||"";k&&$e(k),o.target.value=""}}),e.jsx(L,{value:re,onChange:o=>$e(o.target.value),placeholder:"/Users/you/path/to/project",className:"bg-background/50"})]}),e.jsxs(Ns,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>cs(!1),children:"Cancel"}),e.jsx(w,{type:"button",onClick:()=>{const o=String(re||"").trim();Oe(j=>({...j,projectRoot:o})),cs(!1)},children:"Save"})]})]})}),e.jsx(fs,{open:ue.open,onOpenChange:o=>{ve||Ae(j=>({...j,open:o}))},children:e.jsxs(js,{className:"sm:max-w-[420px] bg-background/95 backdrop-blur-lg",children:[e.jsxs(vs,{children:[e.jsx(ws,{children:ue.title}),ue.description?e.jsx(Ts,{children:ue.description}):null]}),e.jsxs(Ns,{children:[e.jsx(w,{type:"button",variant:"outline",disabled:ve,onClick:()=>Ae(o=>({...o,open:!1})),children:"Cancel"}),e.jsx(w,{type:"button",variant:"destructive",disabled:ve,onClick:async()=>{if(!Ue.current){Ae(o=>({...o,open:!1}));return}Fe(!0);try{await Ue.current(),Ae(o=>({...o,open:!1}))}finally{Fe(!1)}},children:ve?"Deleting...":ue.confirmText})]})]})})]})}export{xa as default};
